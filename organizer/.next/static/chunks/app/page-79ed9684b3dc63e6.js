(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{141:function(e,r,s){Promise.resolve().then(s.bind(s,6939))},1957:function(e,r,s){"use strict";s.d(r,{Z:function(){return a}});var t=s(7437);function a(){return(0,t.jsx)("div",{className:"flex justify-center items-center min-h-52",children:(0,t.jsx)("div",{className:"w-10 h-10 border-4 border-gray-200 border-t-organizer rounded-full animate-spin"})})}},6939:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return B}});var t=s(7437),a=s(2265),n=s(5922);async function i(){try{let{data:{user:e},error:r}=await n.O.auth.getUser();if(r)return console.error("Error getting user:",r),null;return e}catch(e){return console.error("Error getting user:",e),null}}async function l(){try{let{error:e}=await n.O.auth.signOut();if(e)throw console.error("Error signing out:",e),e;sessionStorage.clear()}catch(e){throw console.error("Error signing out:",e),e}}async function c(e,r){try{let{data:s,error:t}=await n.O.auth.signInWithPassword({email:e,password:r});if(t)throw t;return s}catch(e){throw console.error("Error signing in:",e),e}}async function o(e,r){try{let{data:s,error:t}=await n.O.auth.signUp({email:e,password:r});if(t)throw t;return s}catch(e){throw console.error("Error signing up:",e),e}}async function d(){try{let{data:e,error:r}=await n.O.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(r)throw r;return e}catch(e){throw console.error("Error signing in with Google:",e),e}}var x=s(4949),u=s(6061),m=s(7042),h=s(4769);function g(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return(0,h.m6)((0,m.W)(r))}let p=(0,u.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function f(e){let{className:r,variant:s,size:a,asChild:n=!1,...i}=e,l=n?x.g7:"button";return(0,t.jsx)(l,{"data-slot":"button",className:g(p({variant:s,size:a,className:r})),...i})}function b(e){let{className:r,...s}=e;return(0,t.jsx)("div",{"data-slot":"card",className:g("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",r),...s})}function j(e){let{className:r,...s}=e;return(0,t.jsx)("div",{"data-slot":"card-header",className:g("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",r),...s})}function y(e){let{className:r,...s}=e;return(0,t.jsx)("div",{"data-slot":"card-title",className:g("leading-none font-semibold",r),...s})}function v(e){let{className:r,...s}=e;return(0,t.jsx)("div",{"data-slot":"card-content",className:g("px-6",r),...s})}function N(){let[e,r]=(0,a.useState)(!0),[s,n]=(0,a.useState)(""),[i,l]=(0,a.useState)(""),[x,u]=(0,a.useState)(""),[m,h]=(0,a.useState)(!1),g=async r=>{r.preventDefault(),u(""),h(!0);try{e?await c(s,i):await o(s,i)}catch(e){u(e.message||"認証に失敗しました")}finally{h(!1)}},p=async()=>{u(""),h(!0);try{await d()}catch(e){u(e.message||"Google認証に失敗しました"),h(!1)}};return(0,t.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center p-5 bg-gray-50",children:(0,t.jsx)(b,{className:"w-full max-w-md",children:(0,t.jsxs)(v,{className:"pt-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-center mb-8 text-gray-800",children:"主催者向けプラットフォーム"}),(0,t.jsxs)("div",{className:"flex mb-5 border-b border-gray-200",children:[(0,t.jsx)("button",{onClick:()=>{r(!0),u("")},className:"flex-1 px-3 py-3 text-base transition-colors ".concat(e?"border-b-2 border-organizer text-organizer font-bold":"text-gray-600"),children:"ログイン"}),(0,t.jsx)("button",{onClick:()=>{r(!1),u("")},className:"flex-1 px-3 py-3 text-base transition-colors ".concat(e?"text-gray-600":"border-b-2 border-organizer text-organizer font-bold"),children:"新規登録"})]}),x&&(0,t.jsx)("div",{className:"p-3 mb-5 bg-red-50 text-red-700 rounded text-sm",children:x}),(0,t.jsxs)("form",{onSubmit:g,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block mb-2 text-sm text-gray-700",children:"メールアドレス"}),(0,t.jsx)("input",{type:"email",value:s,onChange:e=>n(e.target.value),required:!0,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-organizer focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block mb-2 text-sm text-gray-700",children:"パスワード"}),(0,t.jsx)("input",{type:"password",value:i,onChange:e=>l(e.target.value),required:!0,minLength:6,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-organizer focus:border-transparent"})]}),(0,t.jsx)(f,{type:"submit",disabled:m,className:"w-full bg-organizer hover:bg-organizer-dark disabled:opacity-50",children:m?"処理中...":e?"ログイン":"新規登録"})]}),(0,t.jsx)("div",{className:"text-center my-5 text-gray-400 text-sm",children:"または"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)(f,{onClick:p,disabled:m,variant:"outline",className:"w-full",children:[(0,t.jsx)("span",{className:"mr-2",children:"\uD83D\uDD0D"}),"Googleで",e?"ログイン":"登録"]}),(0,t.jsxs)(f,{onClick:()=>{u(""),window.location.href="/api/auth/line-login"},disabled:m,className:"w-full bg-[#06C755] hover:bg-[#05A647] text-white",children:[(0,t.jsx)("span",{className:"mr-2",children:"\uD83D\uDCAC"}),"LINEで",e?"ログイン":"登録"]})]})]})})})}var w=s(4033);function z(e){let{currentStep:r,totalSteps:s}=e,a=r/s*100;return(0,t.jsxs)("div",{className:"w-full mb-5",children:[(0,t.jsx)("div",{className:"w-full h-2 bg-gray-200 rounded overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-organizer transition-all duration-300 ease-in-out",style:{width:"".concat(a,"%")}})}),(0,t.jsxs)("div",{className:"text-center mt-2 text-sm text-gray-600",children:[r," / ",s]})]})}var k=s(1957);function _(){let e=(0,w.useRouter)(),[r,s]=(0,a.useState)(1),[l,c]=(0,a.useState)(!1),[o,d]=(0,a.useState)(""),[x,u]=(0,a.useState)({name:"",organizationName:"",phoneNumber:"",email:""});(0,a.useEffect)(()=>{let e=sessionStorage.getItem("organizer_draft");if(e)try{let r=JSON.parse(e);u(e=>({...e,...r}))}catch(e){console.error("Failed to load draft:",e)}},[]);let m=()=>{sessionStorage.setItem("organizer_draft",JSON.stringify(x))},h=(e,r)=>{u(s=>({...s,[e]:r})),m()},g=()=>!!x.name&&!!x.organizationName&&!!x.phoneNumber&&!!x.email||(d("すべての必須項目を入力してください"),!1),p=async()=>{d(""),c(!0);try{let r=await i();if(!r)throw Error("認証されていません");let{error:s}=await n.O.from("organizers").insert({user_id:r.id,name:x.name,organization_name:x.organizationName,phone_number:x.phoneNumber,email:x.email,is_approved:!1});if(s)throw s;sessionStorage.removeItem("organizer_draft"),e.push("/")}catch(e){d(e.message||"登録に失敗しました")}finally{c(!1)}};return l?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)(k.Z,{})}):(0,t.jsx)("div",{className:"min-h-screen p-5 bg-gray-50",children:(0,t.jsx)(b,{className:"max-w-2xl mx-auto",children:(0,t.jsxs)(v,{className:"pt-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-5 text-center",children:"主催者情報登録"}),(0,t.jsx)(z,{currentStep:r,totalSteps:2}),o&&(0,t.jsx)("div",{className:"p-3 mb-5 bg-red-50 text-red-700 rounded text-sm",children:o}),1===r&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold mb-5",children:"基本情報"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block mb-2 text-sm font-medium",children:["名前 ",(0,t.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,t.jsx)("input",{type:"text",value:x.name,onChange:e=>h("name",e.target.value),required:!0,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-organizer focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block mb-2 text-sm font-medium",children:["組織名 ",(0,t.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,t.jsx)("input",{type:"text",value:x.organizationName,onChange:e=>h("organizationName",e.target.value),required:!0,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-organizer focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block mb-2 text-sm font-medium",children:["電話番号 ",(0,t.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,t.jsx)("input",{type:"tel",value:x.phoneNumber,onChange:e=>h("phoneNumber",e.target.value),required:!0,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-organizer focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block mb-2 text-sm font-medium",children:["メールアドレス ",(0,t.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,t.jsx)("input",{type:"email",value:x.email,onChange:e=>h("email",e.target.value),required:!0,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-organizer focus:border-transparent"})]})]})]}),2===r&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold mb-5",children:"利用規約確認"}),(0,t.jsxs)("div",{className:"p-5 bg-gray-100 rounded-lg mb-5 max-h-96 overflow-y-auto",children:[(0,t.jsx)("h3",{className:"text-base font-bold mb-3",children:"利用規約"}),(0,t.jsxs)("div",{className:"text-sm leading-relaxed text-gray-600 space-y-3",children:[(0,t.jsx)("p",{children:"本サービスをご利用いただくにあたり、以下の利用規約に同意していただく必要があります。"}),(0,t.jsx)("p",{children:"1. 主催者は、提供する情報が正確であることを保証します。"}),(0,t.jsx)("p",{children:"2. 主催者は、イベント情報を適切に管理する責任があります。"}),(0,t.jsx)("p",{children:"3. 主催者は、出店者の申請を公平に審査する義務があります。"}),(0,t.jsx)("p",{children:"4. 個人情報は適切に管理され、本サービスの目的のみに使用されます。"}),(0,t.jsx)("p",{children:"5. 管理者による承認後、イベントを作成できるようになります。"})]})]}),(0,t.jsxs)("label",{className:"flex items-center mb-5 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",required:!0,className:"w-5 h-5 mr-2"}),(0,t.jsxs)("span",{className:"text-sm",children:["利用規約に同意します ",(0,t.jsx)("span",{className:"text-red-600",children:"*"})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 mt-8",children:[r>1&&(0,t.jsx)(f,{onClick:()=>{d(""),r>1&&s(r-1)},variant:"secondary",className:"flex-1",children:"戻る"}),r<2?(0,t.jsx)(f,{onClick:()=>{d(""),1===r&&g()&&s(2)},className:"flex-1 bg-organizer hover:bg-organizer-dark",children:"次へ"}):(0,t.jsx)(f,{onClick:p,className:"flex-1 bg-organizer hover:bg-organizer-dark",children:"登録する"})]})]})})})}var S=s(8203),C=s(6142),D=s(5750);let I={pending:{label:"審査中",className:"bg-orange-100 text-orange-800 border-orange-200"},approved:{label:"承認済み",className:"bg-green-100 text-green-800 border-green-200"},rejected:{label:"却下",className:"bg-red-100 text-red-800 border-red-200"},draft:{label:"下書き",className:"bg-gray-100 text-gray-800 border-gray-200"},published:{label:"公開中",className:"bg-blue-100 text-blue-800 border-blue-200"},closed:{label:"終了",className:"bg-gray-100 text-gray-600 border-gray-200"}};function E(e){let{status:r,className:s}=e,a=I[r];return(0,t.jsx)("span",{className:g("inline-flex items-center rounded-full border px-3 py-1 text-xs font-medium",a.className,s),children:a.label})}let O={store:"hover:border-[#5DABA8]",organizer:"hover:border-[#FF6B35]",admin:"hover:border-[#3B82F6]"};function q(e){let{title:r,date:s,location:a,capacity:n,image:i,status:l,accent:c="store",onClick:o,className:d}=e;return(0,t.jsxs)(b,{className:g("cursor-pointer overflow-hidden rounded-lg transition-all hover:shadow-lg",O[c],d),onClick:o,children:[i&&(0,t.jsx)("div",{className:"aspect-video w-full overflow-hidden bg-gray-100",children:(0,t.jsx)("img",{src:i||"/placeholder.svg",alt:r,className:"h-full w-full object-cover"})}),(0,t.jsxs)(v,{className:"p-4",children:[(0,t.jsxs)("div",{className:"mb-2 flex items-start justify-between gap-2",children:[(0,t.jsx)("h3",{className:"text-balance text-lg font-semibold leading-snug",children:r}),l&&(0,t.jsx)(E,{status:l})]}),(0,t.jsxs)("div",{className:"space-y-2 text-sm text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(S.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:s})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(C.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:a})]}),n&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(D.Z,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["募集: ",n,"店舗"]})]})]})]})]})}var M=s(9883);function Z(){let e=(0,w.useRouter)(),[r,s]=(0,a.useState)([]),[l,c]=(0,a.useState)(!0),[o,d]=(0,a.useState)(null);(0,a.useEffect)(()=>{x()},[]);let x=async()=>{try{let r=await i();if(!r){e.push("/");return}let{data:t,error:a}=await n.O.from("organizers").select("id, is_approved").eq("user_id",r.id).single();if(a)throw a;d(t.id);let{data:l,error:c}=await n.O.from("events").select("*").eq("organizer_id",t.id).order("created_at",{ascending:!1});if(c)throw c;s(l||[])}catch(e){console.error("イベント取得エラー:",e)}finally{c(!1)}},u=(e,r)=>{let s=new Date(e),t=new Date(r),a="".concat(s.getMonth()+1,"/").concat(s.getDate()),n="".concat(t.getMonth()+1,"/").concat(t.getDate());return"".concat(a," - ").concat(n)};return l?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,t.jsx)("div",{className:"text-gray-600",children:"読み込み中..."})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:(0,t.jsxs)("div",{className:"px-4 py-4 flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"イベント管理"}),(0,t.jsxs)(f,{onClick:()=>e.push("/events/new"),className:"bg-organizer hover:bg-organizer-dark",children:[(0,t.jsx)(M.Z,{className:"h-4 w-4 mr-2"}),"新規作成"]})]})}),(0,t.jsx)("main",{className:"px-4 py-4",children:0===r.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"イベントがありません"}),(0,t.jsx)(f,{onClick:()=>e.push("/events/new"),className:"bg-organizer hover:bg-organizer-dark",children:"最初のイベントを作成"})]}):(0,t.jsx)("div",{className:"space-y-4",children:r.map(r=>(0,t.jsx)(q,{title:r.event_name,date:u(r.event_start_date,r.event_end_date),location:r.venue_name,capacity:r.recruitment_count||void 0,image:r.main_image_url||void 0,status:r.approval_status,accent:"organizer",onClick:()=>e.push("/events/".concat(r.id))},r.id))})})]})}var F=s(3589),G=s(5883);function T(){let e=(0,w.useRouter)(),[r,s]=(0,a.useState)(null),[c,o]=(0,a.useState)(!0);(0,a.useEffect)(()=>{d()},[]);let d=async()=>{try{let r=await i();if(!r){e.push("/");return}let{data:t,error:a}=await n.O.from("organizers").select("*").eq("user_id",r.id).single();if(a)throw a;s(t)}catch(e){console.error("主催者情報取得エラー:",e)}finally{o(!1)}},x=async()=>{try{await l(),e.push("/")}catch(e){console.error("ログアウトエラー:",e)}};return c?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,t.jsx)("div",{className:"text-gray-600",children:"読み込み中..."})}):r?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-8",children:[(0,t.jsx)("header",{className:"bg-white border-b border-gray-200",children:(0,t.jsxs)("div",{className:"px-4 py-4 flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"プロフィール"}),(0,t.jsxs)(f,{onClick:()=>e.push("/profile/edit"),size:"sm",className:"bg-organizer hover:bg-organizer-dark",children:[(0,t.jsx)(F.Z,{className:"h-4 w-4 mr-2"}),"編集"]})]})}),(0,t.jsxs)("main",{className:"px-4 py-4 space-y-4",children:[(0,t.jsx)(b,{children:(0,t.jsxs)(v,{className:"pt-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"承認ステータス"}),(0,t.jsx)(E,{status:r.is_approved?"approved":"pending"})]}),!r.is_approved&&(0,t.jsx)("p",{className:"mt-3 text-sm text-gray-600 bg-orange-50 p-3 rounded",children:"管理者による承認待ちです。承認されるとイベントを作成できるようになります。"})]})}),(0,t.jsxs)(b,{children:[(0,t.jsx)(j,{children:(0,t.jsx)(y,{children:"基本情報"})}),(0,t.jsxs)(v,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-[100px_1fr] gap-2 text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"名前"}),(0,t.jsx)("span",{className:"font-medium",children:r.name})]}),(0,t.jsxs)("div",{className:"grid grid-cols-[100px_1fr] gap-2 text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"組織名"}),(0,t.jsx)("span",{className:"font-medium",children:r.organization_name})]}),(0,t.jsxs)("div",{className:"grid grid-cols-[100px_1fr] gap-2 text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"電話番号"}),(0,t.jsx)("span",{className:"font-medium",children:r.phone_number})]}),(0,t.jsxs)("div",{className:"grid grid-cols-[100px_1fr] gap-2 text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"メール"}),(0,t.jsx)("span",{className:"font-medium break-all",children:r.email})]})]})]}),(0,t.jsxs)(f,{onClick:x,variant:"outline",className:"w-full text-red-600 border-red-600 hover:bg-red-50",children:[(0,t.jsx)(G.Z,{className:"h-4 w-4 mr-2"}),"ログアウト"]})]})]}):(0,t.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 p-4",children:(0,t.jsx)(b,{className:"w-full max-w-md",children:(0,t.jsxs)(v,{className:"pt-6 text-center",children:[(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"主催者情報が登録されていません"}),(0,t.jsx)(f,{onClick:()=>e.push("/register"),className:"bg-organizer hover:bg-organizer-dark",children:"情報を登録する"})]})})})}var A=s(690),J=s(3021);function R(){let e=(0,w.useRouter)(),[r,s]=(0,a.useState)([]),[l,c]=(0,a.useState)(!0),[o,d]=(0,a.useState)(0);(0,a.useEffect)(()=>{x()},[]);let x=async()=>{try{let r=await i();if(!r){e.push("/");return}let{data:t,error:a}=await n.O.from("notifications").select("*").eq("user_id",r.id).order("created_at",{ascending:!1});if(a)throw a;s(t||[]),d((null==t?void 0:t.filter(e=>!e.is_read).length)||0)}catch(e){console.error("通知取得エラー:",e)}finally{c(!1)}},u=async e=>{try{let{error:r}=await n.O.from("notifications").update({is_read:!0}).eq("id",e);if(r)throw r;s(r=>r.map(r=>r.id===e?{...r,is_read:!0}:r)),d(e=>Math.max(0,e-1))}catch(e){console.error("既読更新エラー:",e)}},m=async()=>{try{let e=await i();if(!e)return;let{error:r}=await n.O.from("notifications").update({is_read:!0}).eq("user_id",e.id).eq("is_read",!1);if(r)throw r;s(e=>e.map(e=>({...e,is_read:!0}))),d(0)}catch(e){console.error("一括既読更新エラー:",e)}},h=r=>{r.is_read||u(r.id),r.related_id&&e.push("/events/".concat(r.related_id))},p=e=>{let r=new Date(e),s=new Date().getTime()-r.getTime(),t=Math.floor(s/6e4),a=Math.floor(s/36e5),n=Math.floor(s/864e5);return t<1?"たった今":t<60?"".concat(t,"分前"):a<24?"".concat(a,"時間前"):n<7?"".concat(n,"日前"):"".concat(r.getMonth()+1,"/").concat(r.getDate())};return l?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,t.jsx)("div",{className:"text-gray-600",children:"読み込み中..."})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:(0,t.jsx)("div",{className:"px-4 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"通知"}),o>0&&(0,t.jsx)("span",{className:"bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center",children:o>9?"9+":o})]}),o>0&&(0,t.jsxs)(f,{onClick:m,size:"sm",variant:"outline",className:"text-organizer border-organizer hover:bg-organizer hover:text-white",children:[(0,t.jsx)(A.Z,{className:"h-4 w-4 mr-2"}),"すべて既読"]})]})})}),(0,t.jsx)("main",{className:"px-4 py-4",children:0===r.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(J.Z,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-gray-500",children:"通知はありません"})]}):(0,t.jsx)("div",{className:"space-y-3",children:r.map(e=>(0,t.jsx)(b,{className:g("cursor-pointer transition-all hover:shadow-md",!e.is_read&&"border-l-4 border-l-organizer bg-orange-50"),onClick:()=>h(e),children:(0,t.jsx)(v,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:g("flex-shrink-0 mt-1",e.is_read?"text-gray-400":"text-organizer"),children:(0,t.jsx)(J.Z,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h3",{className:g("text-sm font-semibold mb-1",e.is_read?"text-gray-600":"text-gray-900"),children:e.title}),(0,t.jsx)("p",{className:g("text-sm mb-2",e.is_read?"text-gray-500":"text-gray-700"),children:e.message}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:p(e.created_at)})]})]})})},e.id))})})]})}function B(){let[e,r]=(0,a.useState)(null),[s,l]=(0,a.useState)(null),[c,o]=(0,a.useState)(!0),[d,x]=(0,a.useState)("events");(0,a.useEffect)(()=>{u();let{data:{subscription:e}}=n.O.auth.onAuthStateChange(async(e,s)=>{"SIGNED_OUT"!==e&&s?"SIGNED_IN"===e&&s&&await u():(sessionStorage.clear(),r(null),l(null))});return()=>{e.unsubscribe()}},[]);let u=async()=>{try{o(!0);let{data:{session:e},error:s}=await n.O.auth.getSession();if(s||!e){sessionStorage.clear(),r(null),l(null),o(!1);return}let t=await i();if(!t){sessionStorage.clear(),r(null),l(null),o(!1);return}r(t);let{data:a,error:c}=await n.O.from("organizers").select("*").eq("user_id",t.id).single();c&&"PGRST116"!==c.code&&console.error("Error checking organizer:",c),l(a||null)}catch(e){console.error("Error checking auth:",e),sessionStorage.clear(),r(null),l(null)}finally{o(!1)}};if(c)return(0,t.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,t.jsx)(k.Z,{})});if(!e)return(0,t.jsx)(N,{});if(!s)return(0,t.jsx)(_,{});let[m,h]=(0,a.useState)(0);return(0,a.useEffect)(()=>{if(e){let r=async()=>{try{let{data:r,error:s}=await n.O.from("notifications").select("id").eq("user_id",e.id).eq("user_type","organizer").eq("is_read",!1);!s&&r&&h(r.length)}catch(e){console.error("Error loading unread count:",e)}};r();let s=setInterval(r,3e4);return()=>clearInterval(s)}},[e]),(0,a.useEffect)(()=>{{let e=new URLSearchParams(window.location.search);(e.get("eventId")||e.get("applicationId"))&&x("applications")}},[]),(0,t.jsxs)("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[(()=>{switch(d){case"events":default:return(0,t.jsx)(Z,{});case"profile":return(0,t.jsx)(T,{});case"notifications":return(0,t.jsx)(R,{});case"applications":return(0,t.jsx)("div",{className:"p-4",children:"申し込み管理は各イベント詳細ページから利用できます。"})}})(),(0,t.jsxs)("div",{style:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"white",borderTop:"1px solid #e0e0e0",display:"flex",justifyContent:"space-around",padding:"8px 0",zIndex:1e3},children:[(0,t.jsxs)("button",{onClick:()=>x("notifications"),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"notifications"===d?"#FF6B35":"#666"},children:[(0,t.jsxs)("div",{style:{position:"relative"},children:[(0,t.jsx)("span",{style:{fontSize:"24px"},children:"\uD83D\uDD14"}),m>0&&(0,t.jsx)("span",{style:{position:"absolute",top:"-4px",right:"-8px",backgroundColor:"#e74c3c",color:"white",borderRadius:"10px",fontSize:"10px",padding:"2px 6px",minWidth:"18px",textAlign:"center"},children:m>99?"99+":m})]}),(0,t.jsx)("span",{style:{fontSize:"12px",marginTop:"4px"},children:"通知"})]}),(0,t.jsxs)("button",{onClick:()=>x("events"),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"events"===d?"#FF6B35":"#666"},children:[(0,t.jsx)("span",{style:{fontSize:"24px"},children:"\uD83D\uDCC5"}),(0,t.jsx)("span",{style:{fontSize:"12px",marginTop:"4px"},children:"作成・履歴"})]}),(0,t.jsxs)("button",{onClick:()=>x("profile"),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"profile"===d?"#FF6B35":"#666"},children:[(0,t.jsx)("span",{style:{fontSize:"24px"},children:"\uD83D\uDC64"}),(0,t.jsx)("span",{style:{fontSize:"12px",marginTop:"4px"},children:"プロフィール"})]})]})]})}},5922:function(e,r,s){"use strict";s.d(r,{O:function(){return i}});var t=s(9073);let a="https://ybrsltkmllokexwyutik.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlicnNsdGttbGxva2V4d3l1dGlrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMjU5MDMsImV4cCI6MjA4MjcwMTkwM30.s3Y2qgbtCqrG2kuNXZk8hz3cEjCEWmPMC1zNU2mMHZ8";if(!a||!n)throw Error("Missing Supabase environment variables");let i=(0,t.eI)(a,n,{auth:{persistSession:!0,autoRefreshToken:!0}})}},function(e){e.O(0,[534,77,971,938,744],function(){return e(e.s=141)}),_N_E=e.O()}]);