(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2987:function(e,t,i){Promise.resolve().then(i.bind(i,6798))},6798:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return B}});var n=i(7821),r=i(8078),o=i(9381);async function l(){try{let{data:{user:e},error:t}=await o.O.auth.getUser();if(t)return console.error("Error getting user:",t),null;return e}catch(e){return console.error("Error getting user:",e),null}}async function s(e,t){try{let{data:i,error:n}=await o.O.auth.signInWithPassword({email:e,password:t});if(n)throw n;return i}catch(e){throw console.error("Error signing in:",e),e}}async function a(e,t){try{let{data:i,error:n}=await o.O.auth.signUp({email:e,password:t});if(n)throw n;return i}catch(e){throw console.error("Error signing up:",e),e}}async function d(){try{let{data:e,error:t}=await o.O.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)throw t;return e}catch(e){throw console.error("Error signing in with Google:",e),e}}function p(){let[e,t]=(0,r.useState)(!0),[i,o]=(0,r.useState)(""),[l,p]=(0,r.useState)(""),[x,c]=(0,r.useState)(""),[g,u]=(0,r.useState)(!1),h=async t=>{t.preventDefault(),c(""),u(!0);try{e?await s(i,l):await a(i,l)}catch(e){c(e.message||"認証に失敗しました")}finally{u(!1)}},m=async()=>{c(""),u(!0);try{await d()}catch(e){c(e.message||"Google認証に失敗しました"),u(!1)}};return(0,n.jsx)("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",backgroundColor:"#f5f5f5"},children:(0,n.jsxs)("div",{style:{width:"100%",maxWidth:"400px",backgroundColor:"white",borderRadius:"12px",padding:"30px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)"},children:[(0,n.jsx)("h1",{style:{fontSize:"24px",fontWeight:"bold",textAlign:"center",marginBottom:"30px",color:"#333"},children:"出店者向けプラットフォーム"}),(0,n.jsxs)("div",{style:{display:"flex",marginBottom:"20px",borderBottom:"1px solid #e0e0e0"},children:[(0,n.jsx)("button",{onClick:()=>{t(!0),c("")},style:{flex:1,padding:"12px",border:"none",backgroundColor:"transparent",borderBottom:e?"2px solid #5DABA8":"none",color:e?"#5DABA8":"#666",fontWeight:e?"bold":"normal",cursor:"pointer",fontSize:"16px"},children:"ログイン"}),(0,n.jsx)("button",{onClick:()=>{t(!1),c("")},style:{flex:1,padding:"12px",border:"none",backgroundColor:"transparent",borderBottom:e?"none":"2px solid #5DABA8",color:e?"#666":"#5DABA8",fontWeight:e?"normal":"bold",cursor:"pointer",fontSize:"16px"},children:"新規登録"})]}),x&&(0,n.jsx)("div",{style:{padding:"12px",backgroundColor:"#fee",color:"#c33",borderRadius:"4px",marginBottom:"20px",fontSize:"14px"},children:x}),(0,n.jsxs)("form",{onSubmit:h,children:[(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",color:"#333"},children:"メールアドレス"}),(0,n.jsx)("input",{type:"email",value:i,onChange:e=>o(e.target.value),required:!0,style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]}),(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",color:"#333"},children:"パスワード"}),(0,n.jsx)("input",{type:"password",value:l,onChange:e=>p(e.target.value),required:!0,minLength:6,style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]}),(0,n.jsx)("button",{type:"submit",disabled:g,style:{width:"100%",padding:"12px",backgroundColor:g?"#ccc":"#5DABA8",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:g?"not-allowed":"pointer",marginBottom:"16px"},children:g?"処理中...":e?"ログイン":"新規登録"})]}),(0,n.jsx)("div",{style:{textAlign:"center",margin:"20px 0",color:"#999",fontSize:"14px"},children:"または"}),(0,n.jsxs)("button",{onClick:m,disabled:g,style:{width:"100%",padding:"12px",backgroundColor:"white",color:"#333",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px",fontWeight:"500",cursor:g?"not-allowed":"pointer",marginBottom:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[(0,n.jsx)("span",{children:"\uD83D\uDD0D"}),"Googleで",e?"ログイン":"登録"]}),(0,n.jsxs)("button",{onClick:()=>{c(""),window.location.href="/api/auth/line-login"},disabled:g,style:{width:"100%",padding:"12px",backgroundColor:"#06C755",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:g?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[(0,n.jsx)("span",{children:"\uD83D\uDCAC"}),"LINEで",e?"ログイン":"登録"]})]})})}var x=i(6179);async function c(e,t,i){try{let{data:n,error:r}=await o.O.storage.from(e).upload(t,i,{cacheControl:"3600",upsert:!1});if(r)throw r;let{data:l}=o.O.storage.from(e).getPublicUrl(n.path);return l.publicUrl}catch(e){throw console.error("Error uploading image:",e),e}}function g(e){let{currentStep:t,totalSteps:i}=e,r=t/i*100;return(0,n.jsxs)("div",{style:{width:"100%",marginBottom:"20px"},children:[(0,n.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},children:(0,n.jsx)("div",{style:{width:"".concat(r,"%"),height:"100%",backgroundColor:"#5DABA8",transition:"width 0.3s ease"}})}),(0,n.jsxs)("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"14px",color:"#666"},children:[t," / ",i]})]})}var u=i(8397),h=i.n(u);function m(e){let{imageUrl:t,documentType:i,onRecognized:o}=e,[l,s]=(0,r.useState)(!1),[a,d]=(0,r.useState)(null),[p,x]=(0,r.useState)(""),c=async()=>{if(!t){x("画像が選択されていません");return}s(!0),x(""),d(null);try{let e=await fetch("/api/ocr/recognize-document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:t,documentType:i})}),n=await e.json();if(!e.ok)throw Error(n.error||"認識に失敗しました");d(n.data),o(n.data)}catch(e){x(e.message||"画像認識に失敗しました")}finally{s(!1)}};return(0,n.jsxs)("div",{style:{marginTop:"12px"},className:"jsx-ff161281ed666c63",children:[(0,n.jsx)("button",{onClick:c,disabled:l||!t,style:{padding:"8px 16px",backgroundColor:l?"#ccc":"#5DABA8",color:"white",border:"none",borderRadius:"4px",fontSize:"14px",cursor:l||!t?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"8px"},className:"jsx-ff161281ed666c63",children:l?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"jsx-ff161281ed666c63",children:"認識中..."}),(0,n.jsx)("div",{style:{width:"16px",height:"16px",border:"2px solid #fff",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite"},className:"jsx-ff161281ed666c63"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"jsx-ff161281ed666c63",children:"\uD83D\uDD0D"}),(0,n.jsxs)("span",{className:"jsx-ff161281ed666c63",children:[{businessLicense:"営業許可証",vehicleInspection:"車検証",automobileInspection:"自賠責保険",plInsurance:"PL保険"}[i]||"書類","を認識"]})]})}),p&&(0,n.jsx)("div",{style:{marginTop:"8px",padding:"8px",backgroundColor:"#fee",color:"#c33",borderRadius:"4px",fontSize:"12px"},className:"jsx-ff161281ed666c63",children:p}),a&&(0,n.jsxs)("div",{style:{marginTop:"12px",padding:"12px",backgroundColor:"#f0f8ff",borderRadius:"4px",fontSize:"14px"},className:"jsx-ff161281ed666c63",children:[(0,n.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},className:"jsx-ff161281ed666c63",children:"認識結果:"}),(0,n.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",margin:0},className:"jsx-ff161281ed666c63",children:JSON.stringify(a,null,2)})]}),(0,n.jsx)(h(),{id:"ff161281ed666c63",children:"@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"})]})}function f(e){let{label:t,value:i,onChange:o,onFileSelect:l,required:s=!1,enableOCR:a=!1,documentType:d,onRecognized:p}=e,[x,c]=(0,r.useState)(i||null),[g,u]=(0,r.useState)(!1),h=e=>{var t;let i=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!i)return;let n=new FileReader;n.onloadend=()=>{c(n.result)},n.readAsDataURL(i),l(i)};return(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500",color:"#333"},children:[t,s&&(0,n.jsx)("span",{style:{color:"#e74c3c"},children:" *"})]}),(0,n.jsx)("div",{style:{border:"2px dashed #ccc",borderRadius:"8px",padding:"20px",textAlign:"center",backgroundColor:"#f9f9f9"},children:x?(0,n.jsxs)("div",{children:[(0,n.jsx)("img",{src:x,alt:"Preview",style:{maxWidth:"100%",maxHeight:"200px",marginBottom:"10px",borderRadius:"4px"}}),(0,n.jsx)("div",{children:(0,n.jsxs)("label",{style:{display:"inline-block",padding:"8px 16px",backgroundColor:"#5DABA8",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},children:["画像を変更",(0,n.jsx)("input",{type:"file",accept:"image/*",onChange:h,style:{display:"none"},disabled:g})]})})]}):(0,n.jsxs)("label",{style:{display:"block",cursor:"pointer"},children:[(0,n.jsx)("div",{style:{fontSize:"48px",color:"#999",marginBottom:"10px"},children:"\uD83D\uDCF7"}),(0,n.jsx)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"10px"},children:"画像を選択"}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:"JPG, PNG, GIF (最大 5MB)"}),(0,n.jsx)("input",{type:"file",accept:"image/*",onChange:h,style:{display:"none"},disabled:g})]})}),g&&(0,n.jsx)("div",{style:{marginTop:"10px",fontSize:"14px",color:"#666"},children:"アップロード中..."}),a&&x&&d&&(0,n.jsx)(m,{imageUrl:x,documentType:d,onRecognized:e=>{p&&p(e)}})]})}var y=i(1352);function b(){let e=(0,x.useRouter)(),[t,i]=(0,r.useState)(1),[s,a]=(0,r.useState)(!1),[d,p]=(0,r.useState)(""),[u,h]=(0,r.useState)({name:"",gender:"",age:"",phoneNumber:"",email:"",genreCategory:"",genreFreeText:"",businessLicenseImage:null,vehicleInspectionImage:null,automobileInspectionImage:null,plInsuranceImage:null,fireEquipmentLayoutImage:null});(0,r.useEffect)(()=>{let e=sessionStorage.getItem("exhibitor_draft");if(e)try{let t=JSON.parse(e);h(e=>({...e,...t}))}catch(e){console.error("Failed to load draft:",e)}},[]);let m=()=>{let e={name:u.name,gender:u.gender,age:u.age,phoneNumber:u.phoneNumber,email:u.email,genreCategory:u.genreCategory,genreFreeText:u.genreFreeText};sessionStorage.setItem("exhibitor_draft",JSON.stringify(e))},b=(e,t)=>{h(i=>({...i,[e]:t})),m()},j=(e,t)=>{h(i=>({...i,[e]:t}))},v=()=>u.name&&u.gender&&u.age&&u.phoneNumber&&u.email?!(isNaN(Number(u.age))||0>Number(u.age))||(p("年齢は正の数で入力してください"),!1):(p("すべての必須項目を入力してください"),!1),S=async()=>{p(""),a(!0);try{let t=await l();if(!t)throw Error("認証されていません");let i=[],n={};for(let e of["businessLicenseImage","vehicleInspectionImage","automobileInspectionImage","plInsuranceImage","fireEquipmentLayoutImage"]){let r=u[e];if(r){let o="exhibitors/".concat(t.id,"/").concat(e,"_").concat(Date.now(),".").concat(r.name.split(".").pop());i.push(c("documents",o,r).then(t=>(n[e.replace("Image","ImageUrl")]=t,t)))}}await Promise.all(i);let{error:r}=await o.O.from("exhibitors").insert({user_id:t.id,name:u.name,gender:u.gender,age:parseInt(u.age),phone_number:u.phoneNumber,email:u.email,genre_category:u.genreCategory||null,genre_free_text:u.genreFreeText||null,business_license_image_url:n.businessLicenseImageUrl||null,vehicle_inspection_image_url:n.vehicleInspectionImageUrl||null,automobile_inspection_image_url:n.automobileInspectionImageUrl||null,pl_insurance_image_url:n.plInsuranceImageUrl||null,fire_equipment_layout_image_url:n.fireEquipmentLayoutImageUrl||null});if(r)throw r;sessionStorage.removeItem("exhibitor_draft"),e.push("/")}catch(e){p(e.message||"登録に失敗しました")}finally{a(!1)}};return s?(0,n.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsx)(y.Z,{})}):(0,n.jsx)("div",{style:{minHeight:"100vh",padding:"20px",backgroundColor:"#f5f5f5"},children:(0,n.jsxs)("div",{style:{maxWidth:"600px",margin:"0 auto",backgroundColor:"white",borderRadius:"12px",padding:"30px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)"},children:[(0,n.jsx)("h1",{style:{fontSize:"24px",fontWeight:"bold",marginBottom:"20px",textAlign:"center"},children:"出店者情報登録"}),(0,n.jsx)(g,{currentStep:t,totalSteps:3}),d&&(0,n.jsx)("div",{style:{padding:"12px",backgroundColor:"#fee",color:"#c33",borderRadius:"4px",marginBottom:"20px",fontSize:"14px"},children:d}),1===t&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"20px"},children:"基本情報"}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:["名前 ",(0,n.jsx)("span",{style:{color:"#e74c3c"},children:"*"})]}),(0,n.jsx)("input",{type:"text",value:u.name,onChange:e=>b("name",e.target.value),required:!0,style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:["性別 ",(0,n.jsx)("span",{style:{color:"#e74c3c"},children:"*"})]}),(0,n.jsxs)("select",{value:u.gender,onChange:e=>b("gender",e.target.value),required:!0,style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"},children:[(0,n.jsx)("option",{value:"",children:"選択してください"}),(0,n.jsx)("option",{value:"男",children:"男"}),(0,n.jsx)("option",{value:"女",children:"女"}),(0,n.jsx)("option",{value:"それ以外",children:"それ以外"})]})]}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:["年齢 ",(0,n.jsx)("span",{style:{color:"#e74c3c"},children:"*"})]}),(0,n.jsx)("input",{type:"number",value:u.age,onChange:e=>b("age",e.target.value),required:!0,min:"0",style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:["電話番号 ",(0,n.jsx)("span",{style:{color:"#e74c3c"},children:"*"})]}),(0,n.jsx)("input",{type:"tel",value:u.phoneNumber,onChange:e=>b("phoneNumber",e.target.value),required:!0,style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:["メールアドレス ",(0,n.jsx)("span",{style:{color:"#e74c3c"},children:"*"})]}),(0,n.jsx)("input",{type:"email",value:u.email,onChange:e=>b("email",e.target.value),required:!0,style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"ジャンル（カテゴリ）"}),(0,n.jsx)("input",{type:"text",value:u.genreCategory,onChange:e=>b("genreCategory",e.target.value),placeholder:"例: 飲食、雑貨、アート",style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]}),(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"ジャンル（自由記述）"}),(0,n.jsx)("textarea",{value:u.genreFreeText,onChange:e=>b("genreFreeText",e.target.value),placeholder:"ジャンルの詳細を記入してください",rows:4,style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px",fontFamily:"inherit"}})]})]}),2===t&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"20px"},children:"書類アップロード"}),(0,n.jsx)(f,{label:"営業許可証",onFileSelect:e=>j("businessLicenseImage",e),enableOCR:!0,documentType:"businessLicense",onRecognized:e=>{console.log("営業許可証認識結果:",e)}}),(0,n.jsx)(f,{label:"車検証",onFileSelect:e=>j("vehicleInspectionImage",e),enableOCR:!0,documentType:"vehicleInspection",onRecognized:e=>{console.log("車検証認識結果:",e)}}),(0,n.jsx)(f,{label:"自賠責保険",onFileSelect:e=>j("automobileInspectionImage",e),enableOCR:!0,documentType:"automobileInspection",onRecognized:e=>{console.log("自賠責保険認識結果:",e)}}),(0,n.jsx)(f,{label:"PL保険",onFileSelect:e=>j("plInsuranceImage",e),enableOCR:!0,documentType:"plInsurance",onRecognized:e=>{console.log("PL保険認識結果:",e)}}),(0,n.jsx)(f,{label:"消防設備配置図",onFileSelect:e=>j("fireEquipmentLayoutImage",e)})]}),3===t&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"20px"},children:"利用規約確認"}),(0,n.jsxs)("div",{style:{padding:"20px",backgroundColor:"#f9f9f9",borderRadius:"8px",marginBottom:"20px",maxHeight:"400px",overflowY:"auto"},children:[(0,n.jsx)("h3",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"12px"},children:"利用規約"}),(0,n.jsxs)("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#666"},children:[(0,n.jsx)("p",{style:{marginBottom:"12px"},children:"本サービスをご利用いただくにあたり、以下の利用規約に同意していただく必要があります。"}),(0,n.jsx)("p",{style:{marginBottom:"12px"},children:"1. 出店者は、提供する情報が正確であることを保証します。"}),(0,n.jsx)("p",{style:{marginBottom:"12px"},children:"2. 出店者は、必要な書類を適切に提出する責任があります。"}),(0,n.jsx)("p",{style:{marginBottom:"12px"},children:"3. 主催者は、出店者の申請を承認または却下する権利を有します。"}),(0,n.jsx)("p",{style:{marginBottom:"12px"},children:"4. 個人情報は適切に管理され、本サービスの目的のみに使用されます。"})]})]}),(0,n.jsxs)("label",{style:{display:"flex",alignItems:"center",marginBottom:"20px",cursor:"pointer"},children:[(0,n.jsx)("input",{type:"checkbox",required:!0,style:{marginRight:"8px",width:"20px",height:"20px"}}),(0,n.jsxs)("span",{style:{fontSize:"14px"},children:["利用規約に同意します ",(0,n.jsx)("span",{style:{color:"#e74c3c"},children:"*"})]})]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:"12px",marginTop:"30px"},children:[t>1&&(0,n.jsx)("button",{onClick:()=>{p(""),t>1&&i(t-1)},style:{flex:1,padding:"12px",backgroundColor:"#f0f0f0",color:"#333",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"500",cursor:"pointer"},children:"戻る"}),t<3?(0,n.jsx)("button",{onClick:()=>{p(""),1===t?v()&&i(2):2===t&&i(3)},style:{flex:1,padding:"12px",backgroundColor:"#5DABA8",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:"pointer"},children:"次へ"}):(0,n.jsx)("button",{onClick:S,style:{flex:1,padding:"12px",backgroundColor:"#5DABA8",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:"pointer"},children:"登録する"})]})]})})}function j(e){let{event:t,onClick:i}=e,r=e=>{let t=new Date(e);return"".concat(t.getMonth()+1,"/").concat(t.getDate())};return(0,n.jsxs)("div",{onClick:i,style:{backgroundColor:"white",borderRadius:"8px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",cursor:"pointer",transition:"transform 0.2s"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)"},children:[t.main_image_url&&(0,n.jsx)("div",{style:{width:"100%",height:"200px",backgroundImage:"url(".concat(t.main_image_url,")"),backgroundSize:"cover",backgroundPosition:"center"}}),(0,n.jsxs)("div",{style:{padding:"16px"},children:[(0,n.jsx)("h3",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"8px",color:"#333"},children:t.event_name}),(0,n.jsxs)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"8px"},children:["\uD83D\uDCC5 ",r(t.event_start_date)," - ",r(t.event_end_date)]}),(0,n.jsxs)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"8px"},children:["\uD83D\uDCCD ",t.venue_name,t.venue_city&&" (".concat(t.venue_city,")")]}),t.lead_text&&(0,n.jsx)("div",{style:{fontSize:"14px",color:"#999",marginTop:"8px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:t.lead_text})]})]})}function v(){let[e,t]=(0,r.useState)([]),[i,l]=(0,r.useState)(!0),[s,a]=(0,r.useState)("");(0,r.useEffect)(()=>{d()},[]);let d=async()=>{try{l(!0);let e=new Date().toISOString().split("T")[0],i=o.O.from("events").select("*").or("approval_status.eq.approved,approval_status.is.null").gte("application_end_date",e).order("event_start_date",{ascending:!0}),{data:n,error:r}=await i;if(r){if("PGRST116"===r.code||r.message.includes("column")){let{data:i,error:n}=await o.O.from("events").select("*").gte("application_end_date",e).order("event_start_date",{ascending:!0});if(n)throw n;t(i||[])}else throw r}else t(n||[])}catch(e){console.error("Error loading events:",e),a(e.message||"イベントの読み込みに失敗しました")}finally{l(!1)}},p=e=>{window.location.href="/event/".concat(e)};return i?(0,n.jsx)("div",{style:{padding:"20px"},children:(0,n.jsx)(y.Z,{})}):s?(0,n.jsxs)("div",{style:{padding:"20px",textAlign:"center"},children:[(0,n.jsx)("div",{style:{padding:"16px",backgroundColor:"#fee",color:"#c33",borderRadius:"8px",marginBottom:"16px"},children:s}),(0,n.jsx)("button",{onClick:d,style:{padding:"12px 24px",backgroundColor:"#5DABA8",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer"},children:"再読み込み"})]}):(0,n.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"#f5f5f5",paddingBottom:"80px"},children:[(0,n.jsx)("div",{style:{backgroundColor:"white",padding:"16px",borderBottom:"1px solid #e0e0e0",position:"sticky",top:0,zIndex:100},children:(0,n.jsx)("h1",{style:{fontSize:"20px",fontWeight:"bold",color:"#333"},children:"マイイベント"})}),(0,n.jsx)("div",{style:{padding:"20px"},children:0===e.length?(0,n.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[(0,n.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"\uD83D\uDCC5"}),(0,n.jsx)("div",{style:{fontSize:"16px"},children:"現在、申し込み可能なイベントはありません"})]}):(0,n.jsx)("div",{style:{display:"grid",gap:"16px"},children:e.map(e=>(0,n.jsx)(j,{event:e,onClick:()=>p(e.id)},e.id))})})]})}function S(){let[e,t]=(0,r.useState)([]),[i,l]=(0,r.useState)([]),[s,a]=(0,r.useState)(!0),[d,p]=(0,r.useState)(""),[x,c]=(0,r.useState)(""),[g,u]=(0,r.useState)(""),[h,m]=(0,r.useState)(""),[f,b]=(0,r.useState)(""),[v,S]=(0,r.useState)(""),[_,w]=(0,r.useState)(""),[C,z]=(0,r.useState)(null);(0,r.useEffect)(()=>{B()},[]),(0,r.useEffect)(()=>{k()},[e,x,g,h,f,v,_]);let B=async()=>{try{a(!0);let e=new Date().toISOString().split("T")[0],i=o.O.from("events").select("*").gte("application_end_date",e).order("event_start_date",{ascending:!0}),{data:n,error:r}=await i;if(r)throw r;t(n||[]),l(n||[])}catch(e){console.error("Error loading events:",e),p(e.message||"イベントの読み込みに失敗しました")}finally{a(!1)}},k=()=>{let t=[...e];x&&(t=t.filter(e=>{var t;return e.event_name.toLowerCase().includes(x.toLowerCase())||(null===(t=e.lead_text)||void 0===t?void 0:t.toLowerCase().includes(x.toLowerCase()))})),g&&(t=t.filter(e=>e.event_start_date>=g)),h&&(t=t.filter(e=>e.event_end_date<=h)),f&&(t=t.filter(e=>{var t;return null===(t=e.venue_city)||void 0===t?void 0:t.includes(f)})),v&&(t=t.filter(e=>{var t,i;return(null===(t=e.venue_town)||void 0===t?void 0:t.includes(v))||(null===(i=e.venue_city)||void 0===i?void 0:i.includes(v))})),_&&(t=t.filter(e=>{var t;return null===(t=e.genre)||void 0===t?void 0:t.includes(_)})),l(t)},D=e=>{z(e)},I=async e=>{try{let{data:{user:t}}=await o.O.auth.getUser();if(!t){alert("ログインが必要です");return}let{data:i}=await o.O.from("exhibitors").select("id").eq("user_id",t.id).single();if(!i){alert("出店者情報が登録されていません");return}let{error:n}=await o.O.from("event_applications").insert({exhibitor_id:i.id,event_id:e,application_status:"pending"});if(n)throw n;alert("申し込みが完了しました"),z(null),B()}catch(e){alert(e.message||"申し込みに失敗しました")}};return s?(0,n.jsx)("div",{style:{padding:"20px"},children:(0,n.jsx)(y.Z,{})}):C?(0,n.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"#f5f5f5",padding:"20px"},children:[(0,n.jsx)("button",{onClick:()=>z(null),style:{marginBottom:"20px",padding:"8px 16px",backgroundColor:"#f0f0f0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"← 戻る"}),(0,n.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)"},children:[C.main_image_url&&(0,n.jsx)("img",{src:C.main_image_url,alt:C.event_name,style:{width:"100%",maxHeight:"300px",objectFit:"cover",borderRadius:"8px",marginBottom:"20px"}}),(0,n.jsx)("h1",{style:{fontSize:"24px",fontWeight:"bold",marginBottom:"16px"},children:C.event_name}),(0,n.jsxs)("div",{style:{fontSize:"16px",color:"#666",marginBottom:"20px",lineHeight:"1.6"},children:[(0,n.jsxs)("div",{style:{marginBottom:"8px"},children:["\uD83D\uDCC5 ",new Date(C.event_start_date).toLocaleDateString("ja-JP")," - ",new Date(C.event_end_date).toLocaleDateString("ja-JP")]}),(0,n.jsxs)("div",{style:{marginBottom:"8px"},children:["\uD83D\uDCCD ",C.venue_name,C.venue_city&&" (".concat(C.venue_city,")")]}),C.genre&&(0,n.jsxs)("div",{style:{marginBottom:"8px"},children:["\uD83C\uDFF7️ ",C.genre]})]}),C.lead_text&&(0,n.jsx)("div",{style:{fontSize:"16px",lineHeight:"1.6",marginBottom:"20px",padding:"16px",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:C.lead_text}),(0,n.jsx)("button",{onClick:()=>I(C.id),style:{width:"100%",padding:"16px",backgroundColor:"#5DABA8",color:"white",border:"none",borderRadius:"8px",fontSize:"18px",fontWeight:"bold",cursor:"pointer"},children:"このイベントに申し込む"})]})]}):(0,n.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"#f5f5f5",paddingBottom:"80px"},children:[(0,n.jsxs)("div",{style:{backgroundColor:"white",padding:"16px",borderBottom:"1px solid #e0e0e0",position:"sticky",top:0,zIndex:100},children:[(0,n.jsx)("h1",{style:{fontSize:"20px",fontWeight:"bold",marginBottom:"16px"},children:"イベント検索"}),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[(0,n.jsx)("input",{type:"text",placeholder:"キーワード検索",value:x,onChange:e=>c(e.target.value),style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"},children:[(0,n.jsx)("input",{type:"date",value:g,onChange:e=>u(e.target.value),style:{padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"}}),(0,n.jsx)("input",{type:"date",value:h,onChange:e=>m(e.target.value),style:{padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"}})]}),(0,n.jsx)("input",{type:"text",placeholder:"都道府県",value:f,onChange:e=>b(e.target.value),style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}}),(0,n.jsx)("input",{type:"text",placeholder:"市区町村",value:v,onChange:e=>S(e.target.value),style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}}),(0,n.jsx)("input",{type:"text",placeholder:"ジャンル",value:_,onChange:e=>w(e.target.value),style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]})]}),(0,n.jsxs)("div",{style:{padding:"20px"},children:[d&&(0,n.jsx)("div",{style:{padding:"16px",backgroundColor:"#fee",color:"#c33",borderRadius:"8px",marginBottom:"16px"},children:d}),0===i.length?(0,n.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[(0,n.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"\uD83D\uDD0D"}),(0,n.jsx)("div",{style:{fontSize:"16px"},children:"条件に一致するイベントが見つかりませんでした"})]}):(0,n.jsx)("div",{style:{display:"grid",gap:"16px"},children:i.map(e=>(0,n.jsx)(j,{event:e,onClick:()=>D(e)},e.id))})]})]})}function _(e){let{exhibitor:t,onComplete:i,onCancel:l}=e,[s,a]=(0,r.useState)(!1),[d,p]=(0,r.useState)(""),[x,g]=(0,r.useState)({name:t.name,gender:t.gender,age:t.age.toString(),phoneNumber:t.phone_number,email:t.email,genreCategory:t.genre_category||"",genreFreeText:t.genre_free_text||""}),[u,h]=(0,r.useState)({}),m=(e,t)=>{g(i=>({...i,[e]:t}))},b=(e,t)=>{h(i=>({...i,[e]:t}))},j=async e=>{e.preventDefault(),p(""),a(!0);try{let e={name:x.name,gender:x.gender,age:parseInt(x.age),phone_number:x.phoneNumber,email:x.email,genre_category:x.genreCategory||null,genre_free_text:x.genreFreeText||null};for(let i of["businessLicenseImage","vehicleInspectionImage","automobileInspectionImage","plInsuranceImage","fireEquipmentLayoutImage"]){let n=u[i];if(n){let r="exhibitors/".concat(t.id,"/").concat(i,"_").concat(Date.now(),".").concat(n.name.split(".").pop()),o=await c("documents",r,n);e[i.replace("Image","ImageUrl").replace(/([A-Z])/g,"_$1").toLowerCase()]=o}}let{error:n}=await o.O.from("exhibitors").update(e).eq("id",t.id);if(n)throw n;i()}catch(e){p(e.message||"更新に失敗しました")}finally{a(!1)}};return s?(0,n.jsx)("div",{style:{padding:"20px"},children:(0,n.jsx)(y.Z,{})}):(0,n.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"#f5f5f5",paddingBottom:"80px"},children:[(0,n.jsxs)("div",{style:{backgroundColor:"white",padding:"16px",borderBottom:"1px solid #e0e0e0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)("h1",{style:{fontSize:"20px",fontWeight:"bold"},children:"プロフィール編集"}),(0,n.jsx)("button",{onClick:l,style:{padding:"8px 16px",backgroundColor:"#f0f0f0",border:"none",borderRadius:"4px",fontSize:"14px",cursor:"pointer"},children:"キャンセル"})]}),(0,n.jsxs)("div",{style:{padding:"20px"},children:[d&&(0,n.jsx)("div",{style:{padding:"12px",backgroundColor:"#fee",color:"#c33",borderRadius:"4px",marginBottom:"20px"},children:d}),(0,n.jsx)("form",{onSubmit:j,children:(0,n.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)"},children:[(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:["名前 ",(0,n.jsx)("span",{style:{color:"#e74c3c"},children:"*"})]}),(0,n.jsx)("input",{type:"text",value:x.name,onChange:e=>m("name",e.target.value),required:!0,style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:["性別 ",(0,n.jsx)("span",{style:{color:"#e74c3c"},children:"*"})]}),(0,n.jsxs)("select",{value:x.gender,onChange:e=>m("gender",e.target.value),required:!0,style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"},children:[(0,n.jsx)("option",{value:"男",children:"男"}),(0,n.jsx)("option",{value:"女",children:"女"}),(0,n.jsx)("option",{value:"それ以外",children:"それ以外"})]})]}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:["年齢 ",(0,n.jsx)("span",{style:{color:"#e74c3c"},children:"*"})]}),(0,n.jsx)("input",{type:"number",value:x.age,onChange:e=>m("age",e.target.value),required:!0,min:"0",style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:["電話番号 ",(0,n.jsx)("span",{style:{color:"#e74c3c"},children:"*"})]}),(0,n.jsx)("input",{type:"tel",value:x.phoneNumber,onChange:e=>m("phoneNumber",e.target.value),required:!0,style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:["メールアドレス ",(0,n.jsx)("span",{style:{color:"#e74c3c"},children:"*"})]}),(0,n.jsx)("input",{type:"email",value:x.email,onChange:e=>m("email",e.target.value),required:!0,style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"ジャンル（カテゴリ）"}),(0,n.jsx)("input",{type:"text",value:x.genreCategory,onChange:e=>m("genreCategory",e.target.value),style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px"}})]}),(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"ジャンル（自由記述）"}),(0,n.jsx)("textarea",{value:x.genreFreeText,onChange:e=>m("genreFreeText",e.target.value),rows:4,style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"16px",fontFamily:"inherit"}})]}),(0,n.jsxs)("div",{style:{marginTop:"30px",paddingTop:"20px",borderTop:"1px solid #e0e0e0"},children:[(0,n.jsx)("h3",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"16px"},children:"書類画像（変更する場合のみ選択）"}),(0,n.jsx)(f,{label:"営業許可証",value:t.business_license_image_url,onFileSelect:e=>b("businessLicenseImage",e)}),(0,n.jsx)(f,{label:"車検証",value:t.vehicle_inspection_image_url,onFileSelect:e=>b("vehicleInspectionImage",e)}),(0,n.jsx)(f,{label:"自賠責保険",value:t.automobile_inspection_image_url,onFileSelect:e=>b("automobileInspectionImage",e)}),(0,n.jsx)(f,{label:"PL保険",value:t.pl_insurance_image_url,onFileSelect:e=>b("plInsuranceImage",e)}),(0,n.jsx)(f,{label:"消防設備配置図",value:t.fire_equipment_layout_image_url,onFileSelect:e=>b("fireEquipmentLayoutImage",e)})]}),(0,n.jsx)("button",{type:"submit",style:{width:"100%",padding:"16px",backgroundColor:"#5DABA8",color:"white",border:"none",borderRadius:"8px",fontSize:"18px",fontWeight:"bold",cursor:"pointer",marginTop:"20px"},children:"更新する"})]})})]})]})}function w(){let[e,t]=(0,r.useState)(null),[i,s]=(0,r.useState)(!0),[a,d]=(0,r.useState)(""),[p,x]=(0,r.useState)(!1);(0,r.useEffect)(()=>{c()},[]);let c=async()=>{try{s(!0);let e=await l();if(!e){d("ログインが必要です");return}let{data:i,error:n}=await o.O.from("exhibitors").select("*").eq("user_id",e.id).single();if(n)throw n;t(i)}catch(e){console.error("Error loading profile:",e),d(e.message||"プロフィールの読み込みに失敗しました")}finally{s(!1)}};return i?(0,n.jsx)("div",{style:{padding:"20px"},children:(0,n.jsx)(y.Z,{})}):a&&!e?(0,n.jsx)("div",{style:{padding:"20px",textAlign:"center"},children:(0,n.jsx)("div",{style:{padding:"16px",backgroundColor:"#fee",color:"#c33",borderRadius:"8px"},children:a})}):p&&e?(0,n.jsx)(_,{exhibitor:e,onComplete:()=>{x(!1),c()},onCancel:()=>x(!1)}):e?(0,n.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"#f5f5f5",paddingBottom:"80px"},children:[(0,n.jsxs)("div",{style:{backgroundColor:"white",padding:"16px",borderBottom:"1px solid #e0e0e0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)("h1",{style:{fontSize:"20px",fontWeight:"bold"},children:"プロフィール"}),(0,n.jsx)("button",{onClick:()=>x(!0),style:{padding:"8px 16px",backgroundColor:"#5DABA8",color:"white",border:"none",borderRadius:"4px",fontSize:"14px",cursor:"pointer"},children:"編集"})]}),(0,n.jsx)("div",{style:{padding:"20px"},children:(0,n.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)"},children:[(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#999",marginBottom:"4px"},children:"名前"}),(0,n.jsx)("div",{style:{fontSize:"18px",fontWeight:"500"},children:e.name})]}),(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#999",marginBottom:"4px"},children:"性別"}),(0,n.jsx)("div",{style:{fontSize:"18px"},children:e.gender})]}),(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#999",marginBottom:"4px"},children:"年齢"}),(0,n.jsxs)("div",{style:{fontSize:"18px"},children:[e.age,"歳"]})]}),(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#999",marginBottom:"4px"},children:"電話番号"}),(0,n.jsx)("div",{style:{fontSize:"18px"},children:e.phone_number})]}),(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#999",marginBottom:"4px"},children:"メールアドレス"}),(0,n.jsx)("div",{style:{fontSize:"18px"},children:e.email})]}),e.genre_category&&(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#999",marginBottom:"4px"},children:"ジャンル（カテゴリ）"}),(0,n.jsx)("div",{style:{fontSize:"18px"},children:e.genre_category})]}),e.genre_free_text&&(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#999",marginBottom:"4px"},children:"ジャンル（自由記述）"}),(0,n.jsx)("div",{style:{fontSize:"18px",lineHeight:"1.6"},children:e.genre_free_text})]}),(0,n.jsxs)("div",{style:{marginTop:"30px",paddingTop:"20px",borderTop:"1px solid #e0e0e0"},children:[(0,n.jsx)("h3",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"16px"},children:"登録書類"}),e.business_license_image_url&&(0,n.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"8px"},children:"営業許可証"}),(0,n.jsx)("img",{src:e.business_license_image_url,alt:"営業許可証",style:{maxWidth:"100%",maxHeight:"200px",borderRadius:"4px"}})]}),e.vehicle_inspection_image_url&&(0,n.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"8px"},children:"車検証"}),(0,n.jsx)("img",{src:e.vehicle_inspection_image_url,alt:"車検証",style:{maxWidth:"100%",maxHeight:"200px",borderRadius:"4px"}})]}),e.automobile_inspection_image_url&&(0,n.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"8px"},children:"自賠責保険"}),(0,n.jsx)("img",{src:e.automobile_inspection_image_url,alt:"自賠責保険",style:{maxWidth:"100%",maxHeight:"200px",borderRadius:"4px"}})]}),e.pl_insurance_image_url&&(0,n.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"8px"},children:"PL保険"}),(0,n.jsx)("img",{src:e.pl_insurance_image_url,alt:"PL保険",style:{maxWidth:"100%",maxHeight:"200px",borderRadius:"4px"}})]}),e.fire_equipment_layout_image_url&&(0,n.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"8px"},children:"消防設備配置図"}),(0,n.jsx)("img",{src:e.fire_equipment_layout_image_url,alt:"消防設備配置図",style:{maxWidth:"100%",maxHeight:"200px",borderRadius:"4px"}})]})]})]})})]}):(0,n.jsx)("div",{style:{padding:"20px",textAlign:"center"},children:(0,n.jsx)("div",{style:{fontSize:"16px",color:"#999"},children:"プロフィール情報がありません"})})}function C(){let[e,t]=(0,r.useState)([]),[i,s]=(0,r.useState)([]),[a,d]=(0,r.useState)(!0),[p,x]=(0,r.useState)(""),[c,g]=(0,r.useState)("all");(0,r.useEffect)(()=>{u()},[]),(0,r.useEffect)(()=>{h()},[e,c]);let u=async()=>{try{d(!0);let e=await l();if(!e){x("ログインが必要です");return}let{data:i}=await o.O.from("exhibitors").select("id").eq("user_id",e.id).single();if(!i){x("出店者情報が登録されていません");return}let{data:n,error:r}=await o.O.from("event_applications").select("\n          *,\n          event:events (\n            id,\n            event_name,\n            event_start_date,\n            event_end_date,\n            venue_name,\n            main_image_url\n          )\n        ").eq("exhibitor_id",i.id).order("applied_at",{ascending:!1});if(r)throw r;t(n||[])}catch(e){console.error("Error loading applications:",e),x(e.message||"申し込み履歴の読み込みに失敗しました")}finally{d(!1)}},h=()=>{"all"===c?s(e):s(e.filter(e=>e.application_status===c))},m=e=>{switch(e){case"pending":return"審査中";case"approved":return"承認済み";case"rejected":return"却下";default:return e}},f=e=>{switch(e){case"pending":return"#f39c12";case"approved":return"#27ae60";case"rejected":return"#e74c3c";default:return"#999"}};return a?(0,n.jsx)("div",{style:{padding:"20px"},children:(0,n.jsx)(y.Z,{})}):(0,n.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"#f5f5f5",paddingBottom:"80px"},children:[(0,n.jsxs)("div",{style:{backgroundColor:"white",padding:"16px",borderBottom:"1px solid #e0e0e0",position:"sticky",top:0,zIndex:100},children:[(0,n.jsx)("h1",{style:{fontSize:"20px",fontWeight:"bold",marginBottom:"16px"},children:"申し込み履歴"}),(0,n.jsx)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:["all","pending","approved","rejected"].map(e=>(0,n.jsx)("button",{onClick:()=>g(e),style:{padding:"8px 16px",backgroundColor:c===e?"#5DABA8":"#f0f0f0",color:c===e?"white":"#333",border:"none",borderRadius:"4px",fontSize:"14px",cursor:"pointer"},children:"all"===e?"すべて":m(e)},e))})]}),(0,n.jsxs)("div",{style:{padding:"20px"},children:[p&&(0,n.jsx)("div",{style:{padding:"16px",backgroundColor:"#fee",color:"#c33",borderRadius:"8px",marginBottom:"16px"},children:p}),0===i.length?(0,n.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[(0,n.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"\uD83D\uDCCB"}),(0,n.jsx)("div",{style:{fontSize:"16px"},children:"申し込み履歴がありません"})]}):(0,n.jsx)("div",{style:{display:"grid",gap:"16px"},children:i.map(e=>(0,n.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"8px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.event.main_image_url&&(0,n.jsx)("img",{src:e.event.main_image_url,alt:e.event.event_name,style:{width:"100%",height:"150px",objectFit:"cover",borderRadius:"8px",marginBottom:"12px"}}),(0,n.jsx)("h3",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"8px"},children:e.event.event_name}),(0,n.jsxs)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"12px"},children:["\uD83D\uDCC5 ",new Date(e.event.event_start_date).toLocaleDateString("ja-JP")," - ",new Date(e.event.event_end_date).toLocaleDateString("ja-JP")]}),(0,n.jsxs)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"12px"},children:["\uD83D\uDCCD ",e.event.venue_name]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)("div",{children:(0,n.jsx)("span",{style:{padding:"4px 12px",backgroundColor:f(e.application_status),color:"white",borderRadius:"12px",fontSize:"12px",fontWeight:"500"},children:m(e.application_status)})}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:new Date(e.applied_at).toLocaleDateString("ja-JP")})]})]},e.id))})]})]})}function z(){let[e,t]=(0,r.useState)([]),[i,s]=(0,r.useState)(0),[a,d]=(0,r.useState)(!0),[p,x]=(0,r.useState)("");(0,r.useEffect)(()=>{c();let e=setInterval(c,3e4);return()=>clearInterval(e)},[]);let c=async()=>{try{let e=await l();if(!e){d(!1);return}let{data:i,error:n}=await o.O.from("notifications").select("*").eq("user_id",e.id).eq("user_type","exhibitor").order("created_at",{ascending:!1}).limit(50);if(n)throw n;t(i||[]),s((i||[]).filter(e=>!e.is_read).length)}catch(e){console.error("Error loading notifications:",e),x(e.message||"通知の読み込みに失敗しました")}finally{d(!1)}},g=async e=>{try{let{error:i}=await o.O.from("notifications").update({is_read:!0}).eq("id",e);if(i)throw i;t(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t)),s(e=>Math.max(0,e-1))}catch(e){console.error("Error marking notification as read:",e)}},u=async()=>{try{let e=await l();if(!e)return;let{error:i}=await o.O.from("notifications").update({is_read:!0}).eq("user_id",e.id).eq("user_type","exhibitor").eq("is_read",!1);if(i)throw i;t(e=>e.map(e=>({...e,is_read:!0}))),s(0)}catch(e){console.error("Error marking all as read:",e)}},h=e=>{e.is_read||g(e.id),e.related_event_id?window.location.href="/event/".concat(e.related_event_id):e.related_application_id&&(window.location.href="/applications")};return a?(0,n.jsx)("div",{style:{padding:"20px"},children:(0,n.jsx)(y.Z,{})}):(0,n.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"#f5f5f5",paddingBottom:"80px"},children:[(0,n.jsxs)("div",{style:{backgroundColor:"white",padding:"16px",borderBottom:"1px solid #e0e0e0",display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,zIndex:100},children:[(0,n.jsxs)("h1",{style:{fontSize:"20px",fontWeight:"bold"},children:["通知",i>0&&(0,n.jsx)("span",{style:{marginLeft:"8px",padding:"2px 8px",backgroundColor:"#e74c3c",color:"white",borderRadius:"12px",fontSize:"12px"},children:i})]}),i>0&&(0,n.jsx)("button",{onClick:u,style:{padding:"8px 16px",backgroundColor:"#5DABA8",color:"white",border:"none",borderRadius:"4px",fontSize:"14px",cursor:"pointer"},children:"すべて既読にする"})]}),(0,n.jsxs)("div",{style:{padding:"20px"},children:[p&&(0,n.jsx)("div",{style:{padding:"16px",backgroundColor:"#fee",color:"#c33",borderRadius:"8px",marginBottom:"16px"},children:p}),0===e.length?(0,n.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[(0,n.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"\uD83D\uDD14"}),(0,n.jsx)("div",{style:{fontSize:"16px"},children:"通知はありません"})]}):(0,n.jsx)("div",{style:{display:"grid",gap:"12px"},children:e.map(e=>(0,n.jsxs)("div",{onClick:()=>h(e),style:{backgroundColor:e.is_read?"white":"#f0f8ff",borderRadius:"8px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",cursor:"pointer",borderLeft:e.is_read?"none":"4px solid #5DABA8"},children:[(0,n.jsx)("div",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"8px",color:e.is_read?"#666":"#333"},children:e.title}),(0,n.jsx)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"8px",lineHeight:"1.5"},children:e.message}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:new Date(e.created_at).toLocaleString("ja-JP")})]},e.id))})]})]})}function B(){let[e,t]=(0,r.useState)(null),[i,s]=(0,r.useState)(null),[a,d]=(0,r.useState)(!0),[x,c]=(0,r.useState)("home");(0,r.useEffect)(()=>{g();let{data:{subscription:e}}=o.O.auth.onAuthStateChange(async(e,i)=>{"SIGNED_OUT"!==e&&i?"SIGNED_IN"===e&&i&&await g():(sessionStorage.clear(),t(null),s(null))});return()=>{e.unsubscribe()}},[]);let g=async()=>{try{d(!0);let{data:{session:e},error:i}=await o.O.auth.getSession();if(i||!e){sessionStorage.clear(),t(null),s(null),d(!1);return}let n=await l();if(!n){sessionStorage.clear(),t(null),s(null),d(!1);return}t(n);let{data:r,error:a}=await o.O.from("exhibitors").select("*").eq("user_id",n.id).single();a&&"PGRST116"!==a.code&&console.error("Error checking exhibitor:",a),s(r||null)}catch(e){console.error("Error checking auth:",e),sessionStorage.clear(),t(null),s(null)}finally{d(!1)}};if(a)return(0,n.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsx)(y.Z,{})});if(!e)return(0,n.jsx)(p,{});if(!i)return(0,n.jsx)(b,{});let[u,h]=(0,r.useState)(0);return(0,r.useEffect)(()=>{if(e){let t=async()=>{try{let{data:t,error:i}=await o.O.from("notifications").select("id").eq("user_id",e.id).eq("user_type","exhibitor").eq("is_read",!1);!i&&t&&h(t.length)}catch(e){console.error("Error loading unread count:",e)}};t();let i=setInterval(t,3e4);return()=>clearInterval(i)}},[e]),(0,n.jsxs)("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[(()=>{switch(x){case"home":default:return(0,n.jsx)(v,{});case"search":return(0,n.jsx)(S,{});case"profile":return(0,n.jsx)(w,{});case"applications":return(0,n.jsx)(C,{});case"notifications":return(0,n.jsx)(z,{})}})(),(0,n.jsxs)("div",{style:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"white",borderTop:"1px solid #e0e0e0",display:"flex",justifyContent:"space-around",padding:"8px 0",zIndex:1e3},children:[(0,n.jsxs)("button",{onClick:()=>c("notifications"),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"notifications"===x?"#5DABA8":"#666"},children:[(0,n.jsxs)("div",{style:{position:"relative"},children:[(0,n.jsx)("span",{style:{fontSize:"24px"},children:"\uD83D\uDD14"}),u>0&&(0,n.jsx)("span",{style:{position:"absolute",top:"-4px",right:"-8px",backgroundColor:"#e74c3c",color:"white",borderRadius:"10px",fontSize:"10px",padding:"2px 6px",minWidth:"18px",textAlign:"center"},children:u>99?"99+":u})]}),(0,n.jsx)("span",{style:{fontSize:"12px",marginTop:"4px"},children:"通知"})]}),(0,n.jsxs)("button",{onClick:()=>c("applications"),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"applications"===x?"#5DABA8":"#666"},children:[(0,n.jsx)("span",{style:{fontSize:"24px"},children:"\uD83D\uDCCB"}),(0,n.jsx)("span",{style:{fontSize:"12px",marginTop:"4px"},children:"履歴"})]}),(0,n.jsxs)("button",{onClick:()=>c("search"),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"search"===x?"#5DABA8":"#666"},children:[(0,n.jsx)("span",{style:{fontSize:"24px"},children:"\uD83D\uDD0D"}),(0,n.jsx)("span",{style:{fontSize:"12px",marginTop:"4px"},children:"検索"})]}),(0,n.jsxs)("button",{onClick:()=>c("profile"),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"profile"===x?"#5DABA8":"#666"},children:[(0,n.jsx)("span",{style:{fontSize:"24px"},children:"\uD83D\uDC64"}),(0,n.jsx)("span",{style:{fontSize:"12px",marginTop:"4px"},children:"プロフィール"})]})]})]})}}},function(e){e.O(0,[808,941,115,141,744],function(){return e(e.s=2987)}),_N_E=e.O()}]);