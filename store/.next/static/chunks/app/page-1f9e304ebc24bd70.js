(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1832:function(e,t,s){Promise.resolve().then(s.bind(s,1893))},1957:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var r=s(7437);function a(){return(0,r.jsx)("div",{className:"flex justify-center items-center min-h-52",children:(0,r.jsx)("div",{className:"w-10 h-10 border-4 border-gray-200 border-t-store rounded-full animate-spin"})})}},1893:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ee}});var r=s(7437),a=s(2265),n=s(5922);async function l(){try{let{data:{user:e},error:t}=await n.O.auth.getUser();if(t)return console.error("Error getting user:",t),null;return e}catch(e){return console.error("Error getting user:",e),null}}async function i(){try{let{error:e}=await n.O.auth.signOut();if(e)throw console.error("Error signing out:",e),e;sessionStorage.clear()}catch(e){throw console.error("Error signing out:",e),e}}async function c(e,t){try{let{data:s,error:r}=await n.O.auth.signInWithPassword({email:e,password:t});if(r)throw r;return s}catch(e){throw console.error("Error signing in:",e),e}}async function o(e,t){try{let{data:s,error:r}=await n.O.auth.signUp({email:e,password:t});if(r)throw r;return s}catch(e){throw console.error("Error signing up:",e),e}}async function d(){try{let{data:e,error:t}=await n.O.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)throw t;return e}catch(e){throw console.error("Error signing in with Google:",e),e}}var x=s(4949),u=s(6061),m=s(7042),g=s(4769);function h(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,g.m6)((0,m.W)(t))}let p=(0,u.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function f(e){let{className:t,variant:s,size:a,asChild:n=!1,...l}=e,i=n?x.g7:"button";return(0,r.jsx)(i,{"data-slot":"button",className:h(p({variant:s,size:a,className:t})),...l})}function b(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card",className:h("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function j(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:h("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function y(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:h("leading-none font-semibold",t),...s})}function v(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:h("px-6",t),...s})}function N(){let[e,t]=(0,a.useState)(!0),[s,n]=(0,a.useState)(""),[l,i]=(0,a.useState)(""),[x,u]=(0,a.useState)(""),[m,g]=(0,a.useState)(!1),h=async t=>{t.preventDefault(),u(""),g(!0);try{e?await c(s,l):await o(s,l)}catch(e){u(e.message||"認証に失敗しました")}finally{g(!1)}},p=async()=>{u(""),g(!0);try{await d()}catch(e){u(e.message||"Google認証に失敗しました"),g(!1)}};return(0,r.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center p-5 bg-gray-50",children:(0,r.jsx)(b,{className:"w-full max-w-md",children:(0,r.jsxs)(v,{className:"pt-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-center mb-8 text-gray-800",children:"出店者向けプラットフォーム"}),(0,r.jsxs)("div",{className:"flex mb-5 border-b border-gray-200",children:[(0,r.jsx)("button",{onClick:()=>{t(!0),u("")},className:"flex-1 px-3 py-3 text-base transition-colors ".concat(e?"border-b-2 border-store text-store font-bold":"text-gray-600"),children:"ログイン"}),(0,r.jsx)("button",{onClick:()=>{t(!1),u("")},className:"flex-1 px-3 py-3 text-base transition-colors ".concat(e?"text-gray-600":"border-b-2 border-store text-store font-bold"),children:"新規登録"})]}),x&&(0,r.jsx)("div",{className:"p-3 mb-5 bg-red-50 text-red-700 rounded text-sm",children:x}),(0,r.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block mb-2 text-sm text-gray-700",children:"メールアドレス"}),(0,r.jsx)("input",{type:"email",value:s,onChange:e=>n(e.target.value),required:!0,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block mb-2 text-sm text-gray-700",children:"パスワード"}),(0,r.jsx)("input",{type:"password",value:l,onChange:e=>i(e.target.value),required:!0,minLength:6,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"})]}),(0,r.jsx)(f,{type:"submit",disabled:m,className:"w-full bg-store hover:bg-store-dark disabled:opacity-50",children:m?"処理中...":e?"ログイン":"新規登録"})]}),(0,r.jsx)("div",{className:"text-center my-5 text-gray-400 text-sm",children:"または"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)(f,{onClick:p,disabled:m,variant:"outline",className:"w-full",children:[(0,r.jsx)("span",{className:"mr-2",children:"\uD83D\uDD0D"}),"Googleで",e?"ログイン":"登録"]}),(0,r.jsxs)(f,{onClick:()=>{u(""),window.location.href="/api/auth/line-login"},disabled:m,className:"w-full bg-[#06C755] hover:bg-[#05A647] text-white",children:[(0,r.jsx)("span",{className:"mr-2",children:"\uD83D\uDCAC"}),"LINEで",e?"ログイン":"登録"]})]})]})})})}var w=s(4033);async function _(e,t,s){try{let{data:r,error:a}=await n.O.storage.from(e).upload(t,s,{cacheControl:"3600",upsert:!1});if(a)throw a;let{data:l}=n.O.storage.from(e).getPublicUrl(r.path);return l.publicUrl}catch(e){throw console.error("Error uploading image:",e),e}}function k(e){let{currentStep:t,totalSteps:s}=e,a=t/s*100;return(0,r.jsxs)("div",{className:"w-full mb-5",children:[(0,r.jsx)("div",{className:"w-full h-2 bg-gray-200 rounded overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-store transition-all duration-300 ease-in-out",style:{width:"".concat(a,"%")}})}),(0,r.jsxs)("div",{className:"text-center mt-2 text-sm text-gray-600",children:[t," / ",s]})]})}var C=s(9102),D=s.n(C);function S(e){let{imageUrl:t,documentType:s,onRecognized:n}=e,[l,i]=(0,a.useState)(!1),[c,o]=(0,a.useState)(null),[d,x]=(0,a.useState)(""),u=async()=>{if(!t){x("画像が選択されていません");return}i(!0),x(""),o(null);try{let e=await fetch("/api/ocr/recognize-document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:t,documentType:s})}),r=await e.json();if(!e.ok)throw Error(r.error||"認識に失敗しました");o(r.data),n(r.data)}catch(e){x(e.message||"画像認識に失敗しました")}finally{i(!1)}};return(0,r.jsxs)("div",{style:{marginTop:"12px"},className:"jsx-ff161281ed666c63",children:[(0,r.jsx)("button",{onClick:u,disabled:l||!t,style:{padding:"8px 16px",backgroundColor:l?"#ccc":"#5DABA8",color:"white",border:"none",borderRadius:"4px",fontSize:"14px",cursor:l||!t?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"8px"},className:"jsx-ff161281ed666c63",children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"jsx-ff161281ed666c63",children:"認識中..."}),(0,r.jsx)("div",{style:{width:"16px",height:"16px",border:"2px solid #fff",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite"},className:"jsx-ff161281ed666c63"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"jsx-ff161281ed666c63",children:"\uD83D\uDD0D"}),(0,r.jsxs)("span",{className:"jsx-ff161281ed666c63",children:[{businessLicense:"営業許可証",vehicleInspection:"車検証",automobileInspection:"自賠責保険",plInsurance:"PL保険"}[s]||"書類","を認識"]})]})}),d&&(0,r.jsx)("div",{style:{marginTop:"8px",padding:"8px",backgroundColor:"#fee",color:"#c33",borderRadius:"4px",fontSize:"12px"},className:"jsx-ff161281ed666c63",children:d}),c&&(0,r.jsxs)("div",{style:{marginTop:"12px",padding:"12px",backgroundColor:"#f0f8ff",borderRadius:"4px",fontSize:"14px"},className:"jsx-ff161281ed666c63",children:[(0,r.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},className:"jsx-ff161281ed666c63",children:"認識結果:"}),(0,r.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",margin:0},className:"jsx-ff161281ed666c63",children:JSON.stringify(c,null,2)})]}),(0,r.jsx)(D(),{id:"ff161281ed666c63",children:"@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"})]})}function I(e){let{label:t,value:s,onChange:n,onFileSelect:l,required:i=!1,enableOCR:c=!1,documentType:o,onRecognized:d}=e,[x,u]=(0,a.useState)(s||null),[m,g]=(0,a.useState)(!1),h=e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!s)return;let r=new FileReader;r.onloadend=()=>{u(r.result)},r.readAsDataURL(s),l(s)};return(0,r.jsxs)("div",{className:"mb-5",children:[(0,r.jsxs)("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:[t,i&&(0,r.jsx)("span",{className:"text-red-600",children:" *"})]}),(0,r.jsx)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-5 text-center bg-gray-50 hover:bg-gray-100 transition-colors",children:x?(0,r.jsxs)("div",{children:[(0,r.jsx)("img",{src:x,alt:"Preview",className:"max-w-full max-h-52 mx-auto mb-3 rounded"}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"inline-block",children:[(0,r.jsx)(f,{type:"button",className:"bg-store hover:bg-store-dark",disabled:m,onClick:e=>{var s;e.preventDefault(),null===(s=document.getElementById("file-input-".concat(t)))||void 0===s||s.click()},children:"画像を変更"}),(0,r.jsx)("input",{id:"file-input-".concat(t),type:"file",accept:"image/*",onChange:h,className:"hidden",disabled:m})]})})]}):(0,r.jsxs)("label",{className:"block cursor-pointer",children:[(0,r.jsx)("div",{className:"text-5xl text-gray-400 mb-3",children:"\uD83D\uDCF7"}),(0,r.jsx)("div",{className:"text-sm text-gray-600 mb-3",children:"画像を選択"}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"JPG, PNG, GIF (最大 5MB)"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:h,className:"hidden",disabled:m})]})}),m&&(0,r.jsx)("div",{className:"mt-3 text-sm text-gray-600",children:"アップロード中..."}),c&&x&&o&&(0,r.jsx)(S,{imageUrl:x,documentType:o,onRecognized:e=>{d&&d(e)}})]})}var z=s(1957);function O(){let e=(0,w.useRouter)(),[t,s]=(0,a.useState)(1),[i,c]=(0,a.useState)(!1),[o,d]=(0,a.useState)(""),[x,u]=(0,a.useState)({name:"",gender:"",age:"",phoneNumber:"",email:"",genreCategory:"",genreFreeText:"",businessLicenseImage:null,vehicleInspectionImage:null,automobileInspectionImage:null,plInsuranceImage:null,fireEquipmentLayoutImage:null});(0,a.useEffect)(()=>{let e=sessionStorage.getItem("exhibitor_draft");if(e)try{let t=JSON.parse(e);u(e=>({...e,...t}))}catch(e){console.error("Failed to load draft:",e)}},[]);let m=()=>{let e={name:x.name,gender:x.gender,age:x.age,phoneNumber:x.phoneNumber,email:x.email,genreCategory:x.genreCategory,genreFreeText:x.genreFreeText};sessionStorage.setItem("exhibitor_draft",JSON.stringify(e))},g=(e,t)=>{u(s=>({...s,[e]:t})),m()},h=(e,t)=>{u(s=>({...s,[e]:t}))},p=()=>x.name&&x.gender&&x.age&&x.phoneNumber&&x.email?!(isNaN(Number(x.age))||0>Number(x.age))||(d("年齢は正の数で入力してください"),!1):(d("すべての必須項目を入力してください"),!1),j=async()=>{d(""),c(!0);try{let t=await l();if(!t)throw Error("認証されていません");let s=[],r={};for(let e of["businessLicenseImage","vehicleInspectionImage","automobileInspectionImage","plInsuranceImage","fireEquipmentLayoutImage"]){let a=x[e];if(a){let n="exhibitors/".concat(t.id,"/").concat(e,"_").concat(Date.now(),".").concat(a.name.split(".").pop());s.push(_("documents",n,a).then(t=>(r[e.replace("Image","ImageUrl")]=t,t)))}}await Promise.all(s);let{error:a}=await n.O.from("exhibitors").insert({user_id:t.id,name:x.name,gender:x.gender,age:parseInt(x.age),phone_number:x.phoneNumber,email:x.email,genre_category:x.genreCategory||null,genre_free_text:x.genreFreeText||null,business_license_image_url:r.businessLicenseImageUrl||null,vehicle_inspection_image_url:r.vehicleInspectionImageUrl||null,automobile_inspection_image_url:r.automobileInspectionImageUrl||null,pl_insurance_image_url:r.plInsuranceImageUrl||null,fire_equipment_layout_image_url:r.fireEquipmentLayoutImageUrl||null});if(a)throw a;sessionStorage.removeItem("exhibitor_draft"),e.push("/")}catch(e){d(e.message||"登録に失敗しました")}finally{c(!1)}};return i?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)(z.Z,{})}):(0,r.jsx)("div",{className:"min-h-screen p-5 bg-gray-50",children:(0,r.jsx)(b,{className:"max-w-2xl mx-auto",children:(0,r.jsxs)(v,{className:"pt-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-5 text-center",children:"出店者情報登録"}),(0,r.jsx)(k,{currentStep:t,totalSteps:3}),o&&(0,r.jsx)("div",{className:"p-3 mb-5 bg-red-50 text-red-700 rounded text-sm",children:o}),1===t&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-5",children:"基本情報"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block mb-2 text-sm font-medium",children:["名前 ",(0,r.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,r.jsx)("input",{type:"text",value:x.name,onChange:e=>g("name",e.target.value),required:!0,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block mb-2 text-sm font-medium",children:["性別 ",(0,r.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,r.jsxs)("select",{value:x.gender,onChange:e=>g("gender",e.target.value),required:!0,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent",children:[(0,r.jsx)("option",{value:"",children:"選択してください"}),(0,r.jsx)("option",{value:"男",children:"男"}),(0,r.jsx)("option",{value:"女",children:"女"}),(0,r.jsx)("option",{value:"それ以外",children:"それ以外"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block mb-2 text-sm font-medium",children:["年齢 ",(0,r.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,r.jsx)("input",{type:"number",value:x.age,onChange:e=>g("age",e.target.value),required:!0,min:"0",className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block mb-2 text-sm font-medium",children:["電話番号 ",(0,r.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,r.jsx)("input",{type:"tel",value:x.phoneNumber,onChange:e=>g("phoneNumber",e.target.value),required:!0,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block mb-2 text-sm font-medium",children:["メールアドレス ",(0,r.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,r.jsx)("input",{type:"email",value:x.email,onChange:e=>g("email",e.target.value),required:!0,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"ジャンル（カテゴリ）"}),(0,r.jsx)("input",{type:"text",value:x.genreCategory,onChange:e=>g("genreCategory",e.target.value),placeholder:"例: 飲食、雑貨、アート",className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"ジャンル（自由記述）"}),(0,r.jsx)("textarea",{value:x.genreFreeText,onChange:e=>g("genreFreeText",e.target.value),placeholder:"ジャンルの詳細を記入してください",rows:4,className:"w-full px-3 py-3 border border-gray-300 rounded text-base focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent resize-none"})]})]})]}),2===t&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-5",children:"書類アップロード"}),(0,r.jsx)(I,{label:"営業許可証",onFileSelect:e=>h("businessLicenseImage",e),enableOCR:!0,documentType:"businessLicense",onRecognized:e=>{console.log("営業許可証認識結果:",e)}}),(0,r.jsx)(I,{label:"車検証",onFileSelect:e=>h("vehicleInspectionImage",e),enableOCR:!0,documentType:"vehicleInspection",onRecognized:e=>{console.log("車検証認識結果:",e)}}),(0,r.jsx)(I,{label:"自賠責保険",onFileSelect:e=>h("automobileInspectionImage",e),enableOCR:!0,documentType:"automobileInspection",onRecognized:e=>{console.log("自賠責保険認識結果:",e)}}),(0,r.jsx)(I,{label:"PL保険",onFileSelect:e=>h("plInsuranceImage",e),enableOCR:!0,documentType:"plInsurance",onRecognized:e=>{console.log("PL保険認識結果:",e)}}),(0,r.jsx)(I,{label:"消防設備配置図",onFileSelect:e=>h("fireEquipmentLayoutImage",e)})]}),3===t&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-5",children:"利用規約確認"}),(0,r.jsxs)("div",{className:"p-5 bg-gray-100 rounded-lg mb-5 max-h-96 overflow-y-auto",children:[(0,r.jsx)("h3",{className:"text-base font-bold mb-3",children:"利用規約"}),(0,r.jsxs)("div",{className:"text-sm leading-relaxed text-gray-600 space-y-3",children:[(0,r.jsx)("p",{children:"本サービスをご利用いただくにあたり、以下の利用規約に同意していただく必要があります。"}),(0,r.jsx)("p",{children:"1. 出店者は、提供する情報が正確であることを保証します。"}),(0,r.jsx)("p",{children:"2. 出店者は、必要な書類を適切に提出する責任があります。"}),(0,r.jsx)("p",{children:"3. 主催者は、出店者の申請を承認または却下する権利を有します。"}),(0,r.jsx)("p",{children:"4. 個人情報は適切に管理され、本サービスの目的のみに使用されます。"})]})]}),(0,r.jsxs)("label",{className:"flex items-center mb-5 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",required:!0,className:"w-5 h-5 mr-2"}),(0,r.jsxs)("span",{className:"text-sm",children:["利用規約に同意します ",(0,r.jsx)("span",{className:"text-red-600",children:"*"})]})]})]}),(0,r.jsxs)("div",{className:"flex gap-3 mt-8",children:[t>1&&(0,r.jsx)(f,{onClick:()=>{d(""),t>1&&s(t-1)},variant:"secondary",className:"flex-1",children:"戻る"}),t<3?(0,r.jsx)(f,{onClick:()=>{d(""),1===t?p()&&s(2):2===t&&s(3)},className:"flex-1 bg-store hover:bg-store-dark",children:"次へ"}):(0,r.jsx)(f,{onClick:j,className:"flex-1 bg-store hover:bg-store-dark",children:"登録する"})]})]})})})}var E=s(8203),q=s(6142),T=s(5750);let L={pending:{label:"審査中",className:"bg-orange-100 text-orange-800 border-orange-200"},approved:{label:"承認済み",className:"bg-green-100 text-green-800 border-green-200"},rejected:{label:"却下",className:"bg-red-100 text-red-800 border-red-200"},draft:{label:"下書き",className:"bg-gray-100 text-gray-800 border-gray-200"},published:{label:"公開中",className:"bg-blue-100 text-blue-800 border-blue-200"},closed:{label:"終了",className:"bg-gray-100 text-gray-600 border-gray-200"}};function R(e){let{status:t,className:s}=e,a=L[t];return(0,r.jsx)("span",{className:h("inline-flex items-center rounded-full border px-3 py-1 text-xs font-medium",a.className,s),children:a.label})}let Z={store:"hover:border-[#5DABA8]",organizer:"hover:border-[#FF6B35]",admin:"hover:border-[#3B82F6]"};function M(e){let{title:t,date:s,location:a,capacity:n,image:l,status:i,accent:c="store",onClick:o,className:d}=e;return(0,r.jsxs)(b,{className:h("cursor-pointer overflow-hidden rounded-lg transition-all hover:shadow-lg",Z[c],d),onClick:o,children:[l&&(0,r.jsx)("div",{className:"aspect-video w-full overflow-hidden bg-gray-100",children:(0,r.jsx)("img",{src:l||"/placeholder.svg",alt:t,className:"h-full w-full object-cover"})}),(0,r.jsxs)(v,{className:"p-4",children:[(0,r.jsxs)("div",{className:"mb-2 flex items-start justify-between gap-2",children:[(0,r.jsx)("h3",{className:"text-balance text-lg font-semibold leading-snug",children:t}),i&&(0,r.jsx)(R,{status:i})]}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-muted-foreground",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(E.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:s})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(q.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:a})]}),n&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(T.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:["募集: ",n,"店舗"]})]})]})]})]})}var F=s(3021),A=s(8244),U=s(1827),B=s(7972);function G(){let e=(0,w.useRouter)(),[t,s]=(0,a.useState)([]),[l,i]=(0,a.useState)(!0),[c,o]=(0,a.useState)("home"),[d,x]=(0,a.useState)(0);(0,a.useEffect)(()=>{u(),m()},[]);let u=async()=>{try{let{data:e,error:t}=await n.O.from("events").select("*").eq("approval_status","approved").order("event_start_date",{ascending:!0});if(t)throw t;s(e||[])}catch(e){console.error("イベント取得エラー:",e)}finally{i(!1)}},m=async()=>{try{let{data:{user:e}}=await n.O.auth.getUser();if(!e)return;let{count:t,error:s}=await n.O.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",e.id).eq("is_read",!1);if(s)throw s;x(t||0)}catch(e){console.error("通知取得エラー:",e)}},g=(e,t)=>{let s=new Date(e),r=new Date(t),a="".concat(s.getMonth()+1,"/").concat(s.getDate()),n="".concat(r.getMonth()+1,"/").concat(r.getDate());return"".concat(a," - ").concat(n)};return l?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-gray-600",children:"読み込み中..."})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-20",children:[(0,r.jsx)("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:(0,r.jsx)("div",{className:"px-4 py-4",children:(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"イベント一覧"})})}),(0,r.jsx)("main",{className:"px-4 py-4",children:0===t.length?(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-gray-500",children:"現在、申し込み可能なイベントはありません"})}):(0,r.jsx)("div",{className:"space-y-4",children:t.map(t=>(0,r.jsx)(M,{title:t.event_name,date:g(t.event_start_date,t.event_end_date),location:t.venue_name,capacity:t.recruitment_count||void 0,image:t.main_image_url||void 0,status:t.approval_status,accent:"store",onClick:()=>e.push("/events/".concat(t.id))},t.id))})}),(0,r.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-20",children:(0,r.jsxs)("div",{className:"flex items-center justify-around h-16",children:[(0,r.jsxs)("button",{onClick:()=>o("notifications"),className:h("flex flex-col items-center justify-center flex-1 h-full transition-colors relative","notifications"===c?"text-store":"text-gray-500"),children:[(0,r.jsx)(F.Z,{className:"h-6 w-6"}),d>0&&(0,r.jsx)("span",{className:"absolute top-2 right-[calc(50%-8px)] bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:d>9?"9+":d}),(0,r.jsx)("span",{className:"text-xs mt-1",children:"通知"})]}),(0,r.jsxs)("button",{onClick:()=>o("history"),className:h("flex flex-col items-center justify-center flex-1 h-full transition-colors","history"===c?"text-store":"text-gray-500"),children:[(0,r.jsx)(A.Z,{className:"h-6 w-6"}),(0,r.jsx)("span",{className:"text-xs mt-1",children:"履歴"})]}),(0,r.jsxs)("button",{onClick:()=>o("search"),className:h("flex flex-col items-center justify-center flex-1 h-full transition-colors","search"===c?"text-store":"text-gray-500"),children:[(0,r.jsx)(U.Z,{className:"h-6 w-6"}),(0,r.jsx)("span",{className:"text-xs mt-1",children:"検索"})]}),(0,r.jsxs)("button",{onClick:()=>o("profile"),className:h("flex flex-col items-center justify-center flex-1 h-full transition-colors","profile"===c?"text-store":"text-gray-500"),children:[(0,r.jsx)(B.Z,{className:"h-6 w-6"}),(0,r.jsx)("span",{className:"text-xs mt-1",children:"プロフィール"})]})]})})]})}var P=s(2549);function J(){let e=(0,w.useRouter)(),[t,s]=(0,a.useState)([]),[l,i]=(0,a.useState)([]),[c,o]=(0,a.useState)(!0),[d,x]=(0,a.useState)({keyword:"",startDate:"",endDate:"",prefecture:"",city:"",genre:""});(0,a.useEffect)(()=>{u()},[]),(0,a.useEffect)(()=>{m()},[t,d]);let u=async()=>{try{let{data:e,error:t}=await n.O.from("events").select("*").eq("approval_status","approved").order("event_start_date",{ascending:!0});if(t)throw t;s(e||[]),i(e||[])}catch(e){console.error("イベント取得エラー:",e)}finally{o(!1)}},m=()=>{let e=[...t];d.keyword&&(e=e.filter(e=>e.event_name.toLowerCase().includes(d.keyword.toLowerCase())||e.venue_name.toLowerCase().includes(d.keyword.toLowerCase()))),d.startDate&&(e=e.filter(e=>new Date(e.event_start_date)>=new Date(d.startDate))),d.endDate&&(e=e.filter(e=>new Date(e.event_end_date)<=new Date(d.endDate))),d.prefecture&&(e=e.filter(e=>{var t;return null===(t=e.venue_address)||void 0===t?void 0:t.includes(d.prefecture)})),d.city&&(e=e.filter(e=>{var t;return null===(t=e.venue_address)||void 0===t?void 0:t.toLowerCase().includes(d.city.toLowerCase())})),d.genre&&(e=e.filter(e=>{var t;return null===(t=e.genre_category)||void 0===t?void 0:t.toLowerCase().includes(d.genre.toLowerCase())})),i(e)},g=(e,t)=>{let s=new Date(e),r=new Date(t),a="".concat(s.getMonth()+1,"/").concat(s.getDate()),n="".concat(r.getMonth()+1,"/").concat(r.getDate());return"".concat(a," - ").concat(n)},h=Object.values(d).some(e=>""!==e);return c?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-gray-600",children:"読み込み中..."})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:(0,r.jsxs)("div",{className:"px-4 py-4",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-800 mb-4",children:"イベント検索"}),(0,r.jsx)(b,{children:(0,r.jsxs)(v,{className:"pt-4 space-y-3",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(U.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{type:"text",placeholder:"イベント名、会場名で検索",value:d.keyword,onChange:e=>x(t=>({...t,keyword:e.target.value})),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsx)("input",{type:"date",value:d.startDate,onChange:e=>x(t=>({...t,startDate:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"}),(0,r.jsx)("input",{type:"date",value:d.endDate,onChange:e=>x(t=>({...t,endDate:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsx)("input",{type:"text",placeholder:"都道府県",value:d.prefecture,onChange:e=>x(t=>({...t,prefecture:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"}),(0,r.jsx)("input",{type:"text",placeholder:"市区町村",value:d.city,onChange:e=>x(t=>({...t,city:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"})]}),(0,r.jsx)("input",{type:"text",placeholder:"ジャンル",value:d.genre,onChange:e=>x(t=>({...t,genre:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-store focus:border-transparent"}),h&&(0,r.jsxs)(f,{onClick:()=>{x({keyword:"",startDate:"",endDate:"",prefecture:"",city:"",genre:""})},variant:"outline",size:"sm",className:"w-full",children:[(0,r.jsx)(P.Z,{className:"h-4 w-4 mr-2"}),"フィルターをクリア"]})]})}),(0,r.jsxs)("p",{className:"mt-3 text-sm text-gray-600",children:[l.length,"件のイベントが見つかりました"]})]})}),(0,r.jsx)("main",{className:"px-4 py-4",children:0===l.length?(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-gray-500",children:"条件に一致するイベントが見つかりませんでした"})}):(0,r.jsx)("div",{className:"space-y-4",children:l.map(t=>(0,r.jsx)(M,{title:t.event_name,date:g(t.event_start_date,t.event_end_date),location:t.venue_name,capacity:t.recruitment_count||void 0,image:t.main_image_url||void 0,status:t.approval_status,accent:"store",onClick:()=>e.push("/events/".concat(t.id))},t.id))})})]})}var W=s(3589),V=s(6637),X=s(5883);let Y={business_license_image_url:"営業許可証",vehicle_inspection_image_url:"車検証",automobile_inspection_image_url:"自賠責保険",pl_insurance_image_url:"PL保険",fire_equipment_layout_image_url:"消防設備配置図"};function H(){let e=(0,w.useRouter)(),[t,s]=(0,a.useState)(null),[c,o]=(0,a.useState)(!0);(0,a.useEffect)(()=>{d()},[]);let d=async()=>{try{let t=await l();if(!t){e.push("/");return}let{data:r,error:a}=await n.O.from("exhibitors").select("*").eq("user_id",t.id).single();if(a)throw a;s(r)}catch(e){console.error("出店者情報取得エラー:",e)}finally{o(!1)}},x=async()=>{try{await i(),e.push("/")}catch(e){console.error("ログアウトエラー:",e)}};return c?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-gray-600",children:"読み込み中..."})}):t?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-8",children:[(0,r.jsx)("header",{className:"bg-white border-b border-gray-200",children:(0,r.jsxs)("div",{className:"px-4 py-4 flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"プロフィール"}),(0,r.jsxs)(f,{onClick:()=>e.push("/profile/edit"),size:"sm",className:"bg-store hover:bg-store-dark",children:[(0,r.jsx)(W.Z,{className:"h-4 w-4 mr-2"}),"編集"]})]})}),(0,r.jsxs)("main",{className:"px-4 py-4 space-y-4",children:[(0,r.jsxs)(b,{children:[(0,r.jsx)(j,{children:(0,r.jsx)(y,{children:"基本情報"})}),(0,r.jsxs)(v,{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"grid grid-cols-[100px_1fr] gap-2 text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"名前"}),(0,r.jsx)("span",{className:"font-medium",children:t.name})]}),(0,r.jsxs)("div",{className:"grid grid-cols-[100px_1fr] gap-2 text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"性別"}),(0,r.jsx)("span",{className:"font-medium",children:t.gender})]}),(0,r.jsxs)("div",{className:"grid grid-cols-[100px_1fr] gap-2 text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"年齢"}),(0,r.jsxs)("span",{className:"font-medium",children:[t.age,"歳"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-[100px_1fr] gap-2 text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"電話番号"}),(0,r.jsx)("span",{className:"font-medium",children:t.phone_number})]}),(0,r.jsxs)("div",{className:"grid grid-cols-[100px_1fr] gap-2 text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"メール"}),(0,r.jsx)("span",{className:"font-medium break-all",children:t.email})]})]})]}),(t.genre_category||t.genre_free_text)&&(0,r.jsxs)(b,{children:[(0,r.jsx)(j,{children:(0,r.jsx)(y,{children:"ジャンル情報"})}),(0,r.jsxs)(v,{className:"space-y-3",children:[t.genre_category&&(0,r.jsxs)("div",{className:"grid grid-cols-[100px_1fr] gap-2 text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"カテゴリ"}),(0,r.jsx)("span",{className:"font-medium",children:t.genre_category})]}),t.genre_free_text&&(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600 block mb-1",children:"詳細"}),(0,r.jsx)("p",{className:"font-medium whitespace-pre-wrap",children:t.genre_free_text})]})]})]}),(0,r.jsxs)(b,{children:[(0,r.jsx)(j,{children:(0,r.jsx)(y,{children:"登録書類"})}),(0,r.jsx)(v,{children:(0,r.jsx)("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(Y).map(e=>{let[s,a]=e,n=t[s];return(0,r.jsx)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:n?(0,r.jsxs)("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"block",children:[(0,r.jsx)("img",{src:n,alt:a,className:"w-full h-32 object-cover"}),(0,r.jsx)("div",{className:"p-2 bg-gray-50 text-xs text-center text-gray-700",children:a})]}):(0,r.jsx)("div",{className:"h-32 flex items-center justify-center bg-gray-100",children:(0,r.jsx)(V.Z,{className:"h-8 w-8 text-gray-400"})})},s)})})})]}),(0,r.jsxs)(f,{onClick:x,variant:"outline",className:"w-full text-red-600 border-red-600 hover:bg-red-50",children:[(0,r.jsx)(X.Z,{className:"h-4 w-4 mr-2"}),"ログアウト"]})]})]}):(0,r.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 p-4",children:(0,r.jsx)(b,{className:"w-full max-w-md",children:(0,r.jsxs)(v,{className:"pt-6 text-center",children:[(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"出店者情報が登録されていません"}),(0,r.jsx)(f,{onClick:()=>e.push("/register"),className:"bg-store hover:bg-store-dark",children:"情報を登録する"})]})})})}function Q(){let e=(0,w.useRouter)(),[t,s]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0),[o,d]=(0,a.useState)("all");(0,a.useEffect)(()=>{x()},[]);let x=async()=>{try{let t=await l();if(!t){e.push("/");return}let{data:r,error:a}=await n.O.from("exhibitors").select("id").eq("user_id",t.id).single();if(a)throw a;let{data:i,error:c}=await n.O.from("event_applications").select("\n          *,\n          events (\n            id,\n            event_name,\n            event_start_date,\n            event_end_date,\n            venue_name,\n            main_image_url\n          )\n        ").eq("exhibitor_id",r.id).order("applied_at",{ascending:!1});if(c)throw c;s(i||[])}catch(e){console.error("申し込み履歴取得エラー:",e)}finally{c(!1)}},u=e=>{let t=new Date(e);return"".concat(t.getFullYear(),"/").concat(t.getMonth()+1,"/").concat(t.getDate())},m=(e,t)=>{let s=new Date(e),r=new Date(t),a="".concat(s.getMonth()+1,"/").concat(s.getDate()),n="".concat(r.getMonth()+1,"/").concat(r.getDate());return"".concat(a," - ").concat(n)},g="all"===o?t:t.filter(e=>e.application_status===o);return i?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-gray-600",children:"読み込み中..."})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:(0,r.jsxs)("div",{className:"px-4 py-4",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-800 mb-4",children:"申し込み履歴"}),(0,r.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:[{status:"all",label:"すべて",color:"bg-gray-100 text-gray-800"},{status:"pending",label:"審査中",color:"bg-orange-100 text-orange-800"},{status:"approved",label:"承認済み",color:"bg-green-100 text-green-800"},{status:"rejected",label:"却下",color:"bg-red-100 text-red-800"}].map(e=>(0,r.jsx)("button",{onClick:()=>d(e.status),className:h("px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors",o===e.status?e.color:"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.label},e.status))})]})}),(0,r.jsx)("main",{className:"px-4 py-4",children:0===g.length?(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-gray-500",children:"申し込み履歴がありません"})}):(0,r.jsx)("div",{className:"space-y-4",children:g.map(t=>(0,r.jsxs)(b,{className:"overflow-hidden cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>e.push("/events/".concat(t.event_id)),children:[t.events.main_image_url&&(0,r.jsx)("div",{className:"aspect-video w-full overflow-hidden bg-gray-100",children:(0,r.jsx)("img",{src:t.events.main_image_url,alt:t.events.event_name,className:"w-full h-full object-cover"})}),(0,r.jsxs)(v,{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold leading-snug",children:t.events.event_name}),(0,r.jsx)(R,{status:t.application_status})]}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-gray-600",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(E.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:m(t.events.event_start_date,t.events.event_end_date)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(q.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:t.events.venue_name})]})]}),(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["申し込み日: ",u(t.applied_at)]}),t.reviewed_at&&(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["審査日: ",u(t.reviewed_at)]})]})]})]},t.id))})})]})}var K=s(690);function $(){let e=(0,w.useRouter)(),[t,s]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0),[o,d]=(0,a.useState)(0);(0,a.useEffect)(()=>{x()},[]);let x=async()=>{try{let t=await l();if(!t){e.push("/");return}let{data:r,error:a}=await n.O.from("notifications").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(a)throw a;s(r||[]),d((null==r?void 0:r.filter(e=>!e.is_read).length)||0)}catch(e){console.error("通知取得エラー:",e)}finally{c(!1)}},u=async e=>{try{let{error:t}=await n.O.from("notifications").update({is_read:!0}).eq("id",e);if(t)throw t;s(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t)),d(e=>Math.max(0,e-1))}catch(e){console.error("既読更新エラー:",e)}},m=async()=>{try{let e=await l();if(!e)return;let{error:t}=await n.O.from("notifications").update({is_read:!0}).eq("user_id",e.id).eq("is_read",!1);if(t)throw t;s(e=>e.map(e=>({...e,is_read:!0}))),d(0)}catch(e){console.error("一括既読更新エラー:",e)}},g=t=>{t.is_read||u(t.id),t.related_id&&e.push("/events/".concat(t.related_id))},p=e=>{let t=new Date(e),s=new Date().getTime()-t.getTime(),r=Math.floor(s/6e4),a=Math.floor(s/36e5),n=Math.floor(s/864e5);return r<1?"たった今":r<60?"".concat(r,"分前"):a<24?"".concat(a,"時間前"):n<7?"".concat(n,"日前"):"".concat(t.getMonth()+1,"/").concat(t.getDate())};return i?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-gray-600",children:"読み込み中..."})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:(0,r.jsx)("div",{className:"px-4 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"通知"}),o>0&&(0,r.jsx)("span",{className:"bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center",children:o>9?"9+":o})]}),o>0&&(0,r.jsxs)(f,{onClick:m,size:"sm",variant:"outline",className:"text-store border-store hover:bg-store hover:text-white",children:[(0,r.jsx)(K.Z,{className:"h-4 w-4 mr-2"}),"すべて既読"]})]})})}),(0,r.jsx)("main",{className:"px-4 py-4",children:0===t.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(F.Z,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),(0,r.jsx)("p",{className:"text-gray-500",children:"通知はありません"})]}):(0,r.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,r.jsx)(b,{className:h("cursor-pointer transition-all hover:shadow-md",!e.is_read&&"border-l-4 border-l-store bg-blue-50"),onClick:()=>g(e),children:(0,r.jsx)(v,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:h("flex-shrink-0 mt-1",e.is_read?"text-gray-400":"text-store"),children:(0,r.jsx)(F.Z,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:h("text-sm font-semibold mb-1",e.is_read?"text-gray-600":"text-gray-900"),children:e.title}),(0,r.jsx)("p",{className:h("text-sm mb-2",e.is_read?"text-gray-500":"text-gray-700"),children:e.message}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:p(e.created_at)})]})]})})},e.id))})})]})}function ee(){let[e,t]=(0,a.useState)(null),[s,i]=(0,a.useState)(null),[c,o]=(0,a.useState)(!0),[d,x]=(0,a.useState)("home");(0,a.useEffect)(()=>{u();let{data:{subscription:e}}=n.O.auth.onAuthStateChange(async(e,s)=>{"SIGNED_OUT"!==e&&s?"SIGNED_IN"===e&&s&&await u():(sessionStorage.clear(),t(null),i(null))});return()=>{e.unsubscribe()}},[]);let u=async()=>{try{o(!0);let{data:{session:e},error:s}=await n.O.auth.getSession();if(s||!e){sessionStorage.clear(),t(null),i(null),o(!1);return}let r=await l();if(!r){sessionStorage.clear(),t(null),i(null),o(!1);return}t(r);let{data:a,error:c}=await n.O.from("exhibitors").select("*").eq("user_id",r.id).single();c&&"PGRST116"!==c.code&&console.error("Error checking exhibitor:",c),i(a||null)}catch(e){console.error("Error checking auth:",e),sessionStorage.clear(),t(null),i(null)}finally{o(!1)}};if(c)return(0,r.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(z.Z,{})});if(!e)return(0,r.jsx)(N,{});if(!s)return(0,r.jsx)(O,{});let[m,g]=(0,a.useState)(0);return(0,a.useEffect)(()=>{if(e){let t=async()=>{try{let{data:t,error:s}=await n.O.from("notifications").select("id").eq("user_id",e.id).eq("user_type","exhibitor").eq("is_read",!1);!s&&t&&g(t.length)}catch(e){console.error("Error loading unread count:",e)}};t();let s=setInterval(t,3e4);return()=>clearInterval(s)}},[e]),(0,r.jsxs)("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[(()=>{switch(d){case"home":default:return(0,r.jsx)(G,{});case"search":return(0,r.jsx)(J,{});case"profile":return(0,r.jsx)(H,{});case"applications":return(0,r.jsx)(Q,{});case"notifications":return(0,r.jsx)($,{})}})(),(0,r.jsxs)("div",{style:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"white",borderTop:"1px solid #e0e0e0",display:"flex",justifyContent:"space-around",padding:"8px 0",zIndex:1e3},children:[(0,r.jsxs)("button",{onClick:()=>x("notifications"),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"notifications"===d?"#5DABA8":"#666"},children:[(0,r.jsxs)("div",{style:{position:"relative"},children:[(0,r.jsx)("span",{style:{fontSize:"24px"},children:"\uD83D\uDD14"}),m>0&&(0,r.jsx)("span",{style:{position:"absolute",top:"-4px",right:"-8px",backgroundColor:"#e74c3c",color:"white",borderRadius:"10px",fontSize:"10px",padding:"2px 6px",minWidth:"18px",textAlign:"center"},children:m>99?"99+":m})]}),(0,r.jsx)("span",{style:{fontSize:"12px",marginTop:"4px"},children:"通知"})]}),(0,r.jsxs)("button",{onClick:()=>x("applications"),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"applications"===d?"#5DABA8":"#666"},children:[(0,r.jsx)("span",{style:{fontSize:"24px"},children:"\uD83D\uDCCB"}),(0,r.jsx)("span",{style:{fontSize:"12px",marginTop:"4px"},children:"履歴"})]}),(0,r.jsxs)("button",{onClick:()=>x("search"),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"search"===d?"#5DABA8":"#666"},children:[(0,r.jsx)("span",{style:{fontSize:"24px"},children:"\uD83D\uDD0D"}),(0,r.jsx)("span",{style:{fontSize:"12px",marginTop:"4px"},children:"検索"})]}),(0,r.jsxs)("button",{onClick:()=>x("profile"),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"profile"===d?"#5DABA8":"#666"},children:[(0,r.jsx)("span",{style:{fontSize:"24px"},children:"\uD83D\uDC64"}),(0,r.jsx)("span",{style:{fontSize:"12px",marginTop:"4px"},children:"プロフィール"})]})]})]})}},5922:function(e,t,s){"use strict";s.d(t,{O:function(){return l}});var r=s(9073);let a="https://ybrsltkmllokexwyutik.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlicnNsdGttbGxva2V4d3l1dGlrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMjU5MDMsImV4cCI6MjA4MjcwMTkwM30.s3Y2qgbtCqrG2kuNXZk8hz3cEjCEWmPMC1zNU2mMHZ8";if(!a||!n)throw Error("Missing Supabase environment variables");let l=(0,r.eI)(a,n,{auth:{persistSession:!0,autoRefreshToken:!0}})}},function(e){e.O(0,[534,547,971,938,744],function(){return e(e.s=1832)}),_N_E=e.O()}]);