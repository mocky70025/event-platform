# 完全セットアップガイド - すべての機能を使えるようにする

このガイドに従って、**すべての機能**を完璧に設定します。

---

## 📋 設定する内容

1. ✅ Supabase（データベース・認証・ストレージ）
2. ✅ LINE Login（出店者・主催者向け）
3. ✅ Google認証（Supabase経由）
4. ✅ OpenAI API（画像認識機能）
5. ✅ 管理者ユーザー作成

所要時間: 約30-40分

---

## 第1章: Supabaseの完全セットアップ

### ステップ1-1: アカウント作成とプロジェクト作成

1. **Supabaseにアクセス**
   ```
   https://supabase.com/
   ```

2. **「Start your project」をクリック**

3. **GitHubアカウントでサインアップ（推奨）**
   - または、メールアドレスでサインアップ

4. **Organization（組織）を作成**
   - Organization name: `My Organization`（任意）
   - 「Continue」をクリック

5. **新規プロジェクトを作成**
   - 「New Project」ボタンをクリック
   - **Name**: `event-platform`（任意の名前）
   - **Database Password**: 強力なパスワードを生成
     - 「Generate a password」をクリック
     - **このパスワードをメモ帳にコピー**（後で使います）
   - **Region**: `Northeast Asia (Tokyo)` を選択
   - **Pricing Plan**: `Free` でOK
   - 「Create new project」をクリック

6. **プロジェクトの初期化を待つ**
   - 1-2分かかります
   - 「Setting up project...」と表示されます
   - 完了すると、ダッシュボードが表示されます

### ステップ1-2: APIキーの取得

1. **Settings（設定）を開く**
   - 左サイドバーの一番下にある「⚙️ Settings」をクリック

2. **API設定を開く**
   - 「API」をクリック

3. **必要な情報をコピー**
   
   以下の2つをメモ帳に**確実にコピー**してください：

   **① Project URL**
   ```
   https://your-project-id.supabase.co
   ```
   
   **② Project API keys の anon public**
   ```
   eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlvdXItcHJvamVjdC1pZCIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNjkwMDAwMDAwLCJleHAiOjE5OTAwMDAwMDB9.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```
   
   メモ帳に以下の形式で保存：
   ```
   Supabase URL: https://your-project-id.supabase.co
   Supabase Anon Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```

### ステップ1-3: データベーステーブルの作成

1. **SQL Editorを開く**
   - 左サイドバーの「🔍 SQL Editor」をクリック

2. **新しいクエリを作成**
   - 右上の「+ New query」ボタンをクリック

#### テーブル作成（1つずつ実行）

**重要**: 以下のSQLを**1つずつ**、順番に実行してください。

---

**📋 SQL 1/5: organizers（主催者テーブル）**

```sql
-- organizersテーブル作成
CREATE TABLE organizers (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  organization_name TEXT NOT NULL,
  email TEXT NOT NULL,
  phone_number TEXT NOT NULL,
  is_approved BOOLEAN DEFAULT false,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLS（Row Level Security）を有効化
ALTER TABLE organizers ENABLE ROW LEVEL SECURITY;

-- ポリシー: 自分のデータを閲覧
CREATE POLICY "organizers_select_own" ON organizers
  FOR SELECT USING (auth.uid() = user_id);

-- ポリシー: 自分のデータを挿入
CREATE POLICY "organizers_insert_own" ON organizers
  FOR INSERT WITH CHECK (auth.uid() = user_id);

-- ポリシー: 自分のデータを更新
CREATE POLICY "organizers_update_own" ON organizers
  FOR UPDATE USING (auth.uid() = user_id);

-- インデックス作成
CREATE INDEX idx_organizers_user_id ON organizers(user_id);
CREATE INDEX idx_organizers_is_approved ON organizers(is_approved);
```

**実行方法**:
1. 上記のSQLをコピー
2. SQL Editorに貼り付け
3. 右下の「Run」ボタンをクリック
4. 「Success. No rows returned」と表示されればOK

---

**📋 SQL 2/5: exhibitors（出店者テーブル）**

```sql
-- exhibitorsテーブル作成
CREATE TABLE exhibitors (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  gender TEXT,
  age INTEGER,
  email TEXT NOT NULL,
  phone_number TEXT NOT NULL,
  postal_code TEXT,
  prefecture TEXT,
  city TEXT,
  address_line TEXT,
  genre_category TEXT,
  sales_items TEXT,
  business_license_url TEXT,
  vehicle_inspection_url TEXT,
  liability_insurance_url TEXT,
  pl_insurance_url TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLS有効化
ALTER TABLE exhibitors ENABLE ROW LEVEL SECURITY;

-- ポリシー設定
CREATE POLICY "exhibitors_select_own" ON exhibitors
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "exhibitors_insert_own" ON exhibitors
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "exhibitors_update_own" ON exhibitors
  FOR UPDATE USING (auth.uid() = user_id);

-- インデックス
CREATE INDEX idx_exhibitors_user_id ON exhibitors(user_id);
CREATE INDEX idx_exhibitors_genre_category ON exhibitors(genre_category);
```

**実行**: 同様にコピー、貼り付け、Run

---

**📋 SQL 3/5: events（イベントテーブル）**

```sql
-- eventsテーブル作成
CREATE TABLE events (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  organizer_id UUID REFERENCES organizers(id) ON DELETE CASCADE,
  event_name TEXT NOT NULL,
  event_start_date DATE NOT NULL,
  event_end_date DATE NOT NULL,
  venue_name TEXT NOT NULL,
  venue_address TEXT NOT NULL,
  venue_access TEXT,
  event_description TEXT,
  recruitment_count INTEGER,
  participation_fee INTEGER,
  booth_size TEXT,
  power_supply_available BOOLEAN DEFAULT false,
  water_supply_available BOOLEAN DEFAULT false,
  parking_available BOOLEAN DEFAULT false,
  tent_required BOOLEAN DEFAULT false,
  main_image_url TEXT,
  approval_status TEXT DEFAULT 'pending',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLS有効化
ALTER TABLE events ENABLE ROW LEVEL SECURITY;

-- ポリシー: 全ユーザーがイベントを閲覧可能
CREATE POLICY "events_select_all" ON events
  FOR SELECT USING (true);

-- ポリシー: 主催者のみ自分のイベントを作成
CREATE POLICY "events_insert_own" ON events
  FOR INSERT WITH CHECK (
    EXISTS (
      SELECT 1 FROM organizers
      WHERE organizers.id = events.organizer_id
      AND organizers.user_id = auth.uid()
    )
  );

-- ポリシー: 主催者のみ自分のイベントを更新
CREATE POLICY "events_update_own" ON events
  FOR UPDATE USING (
    EXISTS (
      SELECT 1 FROM organizers
      WHERE organizers.id = events.organizer_id
      AND organizers.user_id = auth.uid()
    )
  );

-- ポリシー: 主催者のみ自分のイベントを削除
CREATE POLICY "events_delete_own" ON events
  FOR DELETE USING (
    EXISTS (
      SELECT 1 FROM organizers
      WHERE organizers.id = events.organizer_id
      AND organizers.user_id = auth.uid()
    )
  );

-- インデックス
CREATE INDEX idx_events_organizer_id ON events(organizer_id);
CREATE INDEX idx_events_approval_status ON events(approval_status);
CREATE INDEX idx_events_start_date ON events(event_start_date);
```

**実行**: 同様にコピー、貼り付け、Run

---

**📋 SQL 4/5: event_applications（申し込みテーブル）**

```sql
-- event_applicationsテーブル作成
CREATE TABLE event_applications (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  event_id UUID REFERENCES events(id) ON DELETE CASCADE,
  exhibitor_id UUID REFERENCES exhibitors(id) ON DELETE CASCADE,
  application_status TEXT DEFAULT 'pending',
  applied_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  reviewed_at TIMESTAMP WITH TIME ZONE,
  UNIQUE(event_id, exhibitor_id)
);

-- RLS有効化
ALTER TABLE event_applications ENABLE ROW LEVEL SECURITY;

-- ポリシー: 出店者は自分の申し込みを閲覧
CREATE POLICY "applications_select_own_exhibitor" ON event_applications
  FOR SELECT USING (
    EXISTS (
      SELECT 1 FROM exhibitors
      WHERE exhibitors.id = event_applications.exhibitor_id
      AND exhibitors.user_id = auth.uid()
    )
  );

-- ポリシー: 主催者は自分のイベントの申し込みを閲覧
CREATE POLICY "applications_select_own_organizer" ON event_applications
  FOR SELECT USING (
    EXISTS (
      SELECT 1 FROM events e
      JOIN organizers o ON o.id = e.organizer_id
      WHERE e.id = event_applications.event_id
      AND o.user_id = auth.uid()
    )
  );

-- ポリシー: 出店者は申し込みを作成
CREATE POLICY "applications_insert_own" ON event_applications
  FOR INSERT WITH CHECK (
    EXISTS (
      SELECT 1 FROM exhibitors
      WHERE exhibitors.id = event_applications.exhibitor_id
      AND exhibitors.user_id = auth.uid()
    )
  );

-- ポリシー: 主催者は申し込みステータスを更新
CREATE POLICY "applications_update_organizer" ON event_applications
  FOR UPDATE USING (
    EXISTS (
      SELECT 1 FROM events e
      JOIN organizers o ON o.id = e.organizer_id
      WHERE e.id = event_applications.event_id
      AND o.user_id = auth.uid()
    )
  );

-- インデックス
CREATE INDEX idx_applications_event_id ON event_applications(event_id);
CREATE INDEX idx_applications_exhibitor_id ON event_applications(exhibitor_id);
CREATE INDEX idx_applications_status ON event_applications(application_status);
```

**実行**: 同様にコピー、貼り付け、Run

---

**📋 SQL 5/5: notifications（通知テーブル）**

```sql
-- notificationsテーブル作成
CREATE TABLE notifications (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  user_type TEXT NOT NULL CHECK (user_type IN ('organizer', 'exhibitor')),
  title TEXT NOT NULL,
  message TEXT NOT NULL,
  is_read BOOLEAN DEFAULT false,
  related_id UUID,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLS有効化
ALTER TABLE notifications ENABLE ROW LEVEL SECURITY;

-- ポリシー: 自分の通知を閲覧
CREATE POLICY "notifications_select_own" ON notifications
  FOR SELECT USING (auth.uid() = user_id);

-- ポリシー: 自分の通知を更新（既読にする）
CREATE POLICY "notifications_update_own" ON notifications
  FOR UPDATE USING (auth.uid() = user_id);

-- ポリシー: システムが通知を作成（認証済みユーザーなら誰でも）
CREATE POLICY "notifications_insert_authenticated" ON notifications
  FOR INSERT WITH CHECK (auth.role() = 'authenticated');

-- インデックス
CREATE INDEX idx_notifications_user_id ON notifications(user_id);
CREATE INDEX idx_notifications_is_read ON notifications(is_read);
CREATE INDEX idx_notifications_created_at ON notifications(created_at DESC);
```

**実行**: 同様にコピー、貼り付け、Run

---

**✅ テーブル作成の確認**

1. 左サイドバーの「Table Editor」をクリック
2. 以下の5つのテーブルが表示されていればOK:
   - ✅ organizers
   - ✅ exhibitors
   - ✅ events
   - ✅ event_applications
   - ✅ notifications

### ステップ1-4: Storageバケットの作成

1. **Storageセクションを開く**
   - 左サイドバーの「📦 Storage」をクリック

2. **documentsバケットを作成**
   - 「Create a new bucket」ボタンをクリック
   - **Name**: `documents`
   - **Public bucket**: ❌ チェックを**外す**（プライベート）
   - 「Create bucket」をクリック

3. **imagesバケットを作成**
   - もう一度「Create a new bucket」をクリック
   - **Name**: `images`
   - **Public bucket**: ✅ チェックを**入れる**（パブリック）
   - 「Create bucket」をクリック

4. **documentsバケットのポリシー設定**
   
   - `documents`バケットをクリック
   - 上部の「Policies」タブをクリック
   - 「New policy」をクリック
   - 「For full customization」の「Get started」をクリック
   
   **ポリシー名**: `Users can upload own documents`
   
   **Policy definition**に以下を貼り付け:
   ```sql
   CREATE POLICY "Users can upload own documents"
   ON storage.objects FOR INSERT
   WITH CHECK (
     bucket_id = 'documents' AND
     auth.uid()::text = (storage.foldername(name))[1]
   );
   ```
   
   - 「Review」をクリック
   - 「Save policy」をクリック
   
   同様に、閲覧ポリシーも追加:
   
   - もう一度「New policy」をクリック
   - **ポリシー名**: `Users can view own documents`
   - **Policy definition**:
   ```sql
   CREATE POLICY "Users can view own documents"
   ON storage.objects FOR SELECT
   USING (
     bucket_id = 'documents' AND
     auth.uid()::text = (storage.foldername(name))[1]
   );
   ```
   
   - 「Review」→「Save policy」をクリック

**✅ Storage設定完了**
- ✅ documentsバケット（プライベート、ポリシー設定済み）
- ✅ imagesバケット（パブリック）

### ステップ1-5: Google認証の設定

1. **Authentication設定を開く**
   - 左サイドバーの「🔐 Authentication」をクリック
   - 「Providers」タブをクリック

2. **Googleプロバイダーを有効化**
   - プロバイダー一覧から「Google」を探す
   - 「Google」の右側のトグルをONにする
   - 「Enabled」と表示されればOK

3. **Google Cloud Consoleでの設定（詳細）**
   
   まず、Supabase側で表示される情報を確認:
   - Googleプロバイダーをクリック
   - **Callback URL (for OAuth)**をコピー
     ```
     https://your-project-id.supabase.co/auth/v1/callback
     ```
   
   次に、Google Cloud Consoleで設定:
   
   **a. Google Cloud Consoleにアクセス**
   ```
   https://console.cloud.google.com/
   ```
   
   **b. プロジェクトを作成**
   - 「プロジェクトを選択」→「新しいプロジェクト」
   - プロジェクト名: `event-platform`
   - 「作成」をクリック
   
   **c. OAuth同意画面を設定**
   - 左メニューの「APIとサービス」→「OAuth同意画面」
   - User Type: 「外部」を選択
   - 「作成」をクリック
   - **アプリ名**: `Event Platform`
   - **ユーザーサポートメール**: あなたのメールアドレス
   - **デベロッパーの連絡先情報**: あなたのメールアドレス
   - 「保存して次へ」を3回クリック
   
   **d. 認証情報を作成**
   - 左メニューの「認証情報」をクリック
   - 「+ 認証情報を作成」→「OAuthクライアントID」
   - アプリケーションの種類: 「ウェブアプリケーション」
   - 名前: `Event Platform Store`
   - **承認済みのリダイレクトURI**:
     - 「+ URIを追加」をクリック
     - 先ほどコピーしたSupabaseのCallback URLを貼り付け
   - 「作成」をクリック
   
   **e. クライアントIDとシークレットをコピー**
   - ポップアップに表示される:
     - **クライアントID**: `123456789-xxxxxxxxxxxxx.apps.googleusercontent.com`
     - **クライアントシークレット**: `GOCSPX-xxxxxxxxxxxxxxxxxxxxx`
   - **この2つをメモ帳にコピー**
   
   **f. SupabaseにGoogle認証情報を設定**
   - Supabaseダッシュボードに戻る
   - Authentication > Providers > Google
   - **Client ID**: 貼り付け
   - **Client Secret**: 貼り付け
   - 「Save」をクリック

**✅ Supabase設定完了！**

メモ帳には以下が保存されているはずです:
```
Supabase URL: https://your-project-id.supabase.co
Supabase Anon Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Google Client ID: 123456789-xxxxxxxxxxxxx.apps.googleusercontent.com
Google Client Secret: GOCSPX-xxxxxxxxxxxxxxxxxxxxx
```

---

## 第2章: LINE Loginの完全セットアップ

LINE Loginを使うと、LINEアカウントでログインできます。

### ステップ2-1: LINE Developersコンソールにアクセス

1. **LINE Developersコンソールにアクセス**
   ```
   https://developers.line.biz/console/
   ```

2. **LINEアカウントでログイン**
   - LINEアカウントを持っていない場合は作成

3. **初回ログイン時の設定**
   - 名前（開発者名）を入力
   - メールアドレスを入力
   - 利用規約に同意
   - 「作成」をクリック

### ステップ2-2: プロバイダーを作成

1. **「作成」ボタンをクリック**

2. **「プロバイダーを作成」を選択**

3. **プロバイダー情報を入力**
   - **プロバイダー名**: `EventPlatform`（任意）
   - 「作成」をクリック

### ステップ2-3: 出店者向けチャネルを作成

1. **「新規チャネル作成」をクリック**

2. **「LINEログイン」を選択**

3. **チャネル情報を入力**
   
   - **チャネル名**: `Event Platform Store`
   - **チャネル説明**: `イベントプラットフォーム 出店者向けアプリ`
   - **アプリタイプ**: 「ウェブアプリ」にチェック
   - **メールアドレス**: あなたのメールアドレス
   - **プライバシーポリシーURL**: `https://example.com/privacy`（後で変更可能）
   - **サービス利用規約URL**: `https://example.com/terms`（後で変更可能）
   
4. **LINE開発者契約に同意**
   - すべてにチェック
   - 「作成」をクリック

5. **チャネル作成完了**
   - チャネルが作成されました

### ステップ2-4: 出店者向けチャネルの設定

1. **Basic settingsタブ**
   
   - **Channel ID**を確認
     ```
     1234567890
     ```
   - **この番号をメモ帳にコピー**（出店者用）
   
   メモ帳に追加:
   ```
   LINE Channel ID (Store): 1234567890
   ```

2. **LINE Loginタブをクリック**

3. **コールバックURLを設定**
   
   - 「Callback URL」セクションの「編集」をクリック
   - 以下のURLを追加:
     ```
     http://localhost:3001/auth/callback
     ```
   - 「更新」をクリック

4. **その他の設定（オプション）**
   - **リンク連携**: オフのまま
   - **IDトークン**: オンのまま

### ステップ2-5: 主催者向けチャネルを作成

同様の手順で主催者向けチャネルも作成します。

1. **プロバイダー画面に戻る**
   - 左上のプロバイダー名をクリック

2. **「新規チャネル作成」をクリック**

3. **「LINEログイン」を選択**

4. **チャネル情報を入力**
   - **チャネル名**: `Event Platform Organizer`
   - **チャネル説明**: `イベントプラットフォーム 主催者向けアプリ`
   - **アプリタイプ**: 「ウェブアプリ」
   - **メールアドレス**: あなたのメールアドレス
   - その他は同様

5. **Basic settingsタブ**
   - **Channel ID**をコピー
     ```
     9876543210
     ```
   
   メモ帳に追加:
   ```
   LINE Channel ID (Organizer): 9876543210
   ```

6. **LINE Loginタブ**
   - Callback URL: `http://localhost:3002/auth/callback`
   - 「更新」をクリック

**✅ LINE Login設定完了！**

メモ帳には以下が追加されているはずです:
```
LINE Channel ID (Store): 1234567890
LINE Channel ID (Organizer): 9876543210
```

---

## 第3章: OpenAI API Keyの取得

画像認識機能（営業許可証、車検証などの自動読み取り）に使用します。

### ステップ3-1: OpenAI Platformにアクセス

1. **OpenAI Platformにアクセス**
   ```
   https://platform.openai.com/
   ```

2. **アカウントを作成**
   - 「Sign up」をクリック
   - Googleアカウントまたはメールアドレスで登録
   - 電話番号認証が必要

3. **ログイン後のセットアップ**
   - 名前を入力
   - 組織名を入力（個人の場合は自分の名前でOK）

### ステップ3-2: 支払い方法の設定

**重要**: OpenAI APIは従量課金制です。無料枠はありません。

1. **Billingページを開く**
   - 左メニューの「Settings」→「Billing」

2. **支払い方法を追加**
   - 「Add payment method」をクリック
   - クレジットカード情報を入力
   - 「Add payment method」をクリック

3. **使用上限を設定（推奨）**
   - 「Usage limits」をクリック
   - **Hard limit**: `$10`（月額上限）を設定
   - これで使いすぎを防げます

### ステップ3-3: API Keyを作成

1. **API keysページを開く**
   - 左メニューの「API keys」をクリック

2. **新しいSecret Keyを作成**
   - 「+ Create new secret key」をクリック
   - **Name**: `event-platform-ocr`
   - **Permissions**: 「All」を選択
   - 「Create secret key」をクリック

3. **API Keyをコピー**
   - 表示されるAPIキーを**すぐにコピー**
     ```
     sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
     ```
   - **⚠️ この画面でしか表示されません！**
   - 「I saved my secret key」をクリック

4. **メモ帳に保存**
   ```
   OpenAI API Key: sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```

### ステップ3-4: 料金について

- **モデル**: gpt-4o（画像認識用）
- **料金**: 入力 $2.50 / 1M tokens、出力 $10.00 / 1M tokens
- **画像認識1回**: 約$0.01-0.02
- **月100回使っても**: 約$1-2

**✅ OpenAI API設定完了！**

---

## 第4章: 環境変数ファイルの作成

すべての情報が揃ったので、環境変数ファイルを作成します。

### ステップ4-1: メモ帳の内容を確認

メモ帳には以下が保存されているはずです:

```
Supabase URL: https://abcdefghijklmnop.supabase.co
Supabase Anon Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Google Client ID: 123456789-xxxxxxxxxxxxx.apps.googleusercontent.com
Google Client Secret: GOCSPX-xxxxxxxxxxxxxxxxxxxxx
LINE Channel ID (Store): 1234567890
LINE Channel ID (Organizer): 9876543210
OpenAI API Key: sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

### ステップ4-2: store/.env.local の作成

ターミナルを開いて、以下を実行:

```bash
cd /Users/mocky700/Desktop/デミセル/store
nano .env.local
```

以下の内容を貼り付け（**メモ帳の値に置き換えて**）:

```env
# Supabase設定
NEXT_PUBLIC_SUPABASE_URL=https://abcdefghijklmnop.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprbG1ub3AiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTY5MDAwMDAwMCwiZXhwIjoxOTkwMDAwMDAwfQ.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# LINE Login設定
NEXT_PUBLIC_LINE_LOGIN_CHANNEL_ID=1234567890
NEXT_PUBLIC_LINE_LOGIN_REDIRECT_URI=http://localhost:3001/auth/callback

# OpenAI API設定（画像認識機能用）
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

保存方法:
1. `Ctrl + O` (書き込み)
2. `Enter`
3. `Ctrl + X` (終了)

### ステップ4-3: organizer/.env.local の作成

```bash
cd /Users/mocky700/Desktop/デミセル/organizer
nano .env.local
```

以下を貼り付け（**メモ帳の値に置き換えて**）:

```env
# Supabase設定
NEXT_PUBLIC_SUPABASE_URL=https://abcdefghijklmnop.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprbG1ub3AiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTY5MDAwMDAwMCwiZXhwIjoxOTkwMDAwMDAwfQ.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# LINE Login設定
NEXT_PUBLIC_LINE_LOGIN_CHANNEL_ID=9876543210
NEXT_PUBLIC_LINE_LOGIN_REDIRECT_URI=http://localhost:3002/auth/callback
```

保存: `Ctrl + O` → `Enter` → `Ctrl + X`

### ステップ4-4: admin/.env.local の作成

```bash
cd /Users/mocky700/Desktop/デミセル/admin
nano .env.local
```

以下を貼り付け（**あなたのメールアドレスを設定**）:

```env
# Supabase設定
NEXT_PUBLIC_SUPABASE_URL=https://abcdefghijklmnop.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprbG1ub3AiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTY5MDAwMDAwMCwiZXhwIjoxOTkwMDAwMDAwfQ.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# 管理者メールアドレス（カンマ区切りで複数指定可能）
NEXT_PUBLIC_ADMIN_EMAILS=admin@example.com,youremail@gmail.com
```

**重要**: `NEXT_PUBLIC_ADMIN_EMAILS`には、実際に使用するメールアドレスを設定してください。

保存: `Ctrl + O` → `Enter` → `Ctrl + X`

**✅ 環境変数ファイル作成完了！**

### ステップ4-5: 環境変数ファイルの確認

```bash
cd /Users/mocky700/Desktop/デミセル
ls -la store/.env.local organizer/.env.local admin/.env.local
```

3つのファイルが表示されればOK。

---

## 第5章: 管理者ユーザーの作成

管理者向けアプリにログインするためのユーザーを作成します。

### ステップ5-1: Supabaseで管理者ユーザーを作成

1. **Supabaseダッシュボードを開く**

2. **Authenticationセクションを開く**
   - 左サイドバーの「🔐 Authentication」をクリック

3. **Usersタブをクリック**

4. **新しいユーザーを追加**
   - 「Add user」ボタンをクリック
   - 「Create new user」を選択

5. **ユーザー情報を入力**
   - **Email**: `admin@example.com`（admin/.env.localで設定したメールアドレス）
   - **Password**: 強力なパスワードを設定（例: `Admin123!@#`）
   - **Auto Confirm User**: ✅ チェックを入れる
   - 「Create user」をクリック

6. **作成完了**
   - ユーザー一覧に表示されればOK
   - このメールアドレスとパスワードで管理者ログインできます

**✅ 管理者ユーザー作成完了！**

ログイン情報をメモ:
```
管理者メールアドレス: admin@example.com
管理者パスワード: Admin123!@#
```

---

## 第6章: アプリの起動と動作確認

すべての設定が完了したので、アプリを起動します。

### ステップ6-1: 出店者向けアプリを起動

新しいターミナルウィンドウを開いて:

```bash
cd /Users/mocky700/Desktop/デミセル/store
npm run dev
```

表示されるメッセージ:
```
> store@0.1.0 dev
> next dev -p 3001

  ▲ Next.js 14.0.4
  - Local:        http://localhost:3001

 ✓ Ready in 2.5s
```

**ブラウザで確認**:
- http://localhost:3001 にアクセス
- ログイン画面が表示されればOK ✅

### ステップ6-2: 主催者向けアプリを起動

**別のターミナルウィンドウ**を開いて:

```bash
cd /Users/mocky700/Desktop/デミセル/organizer
npm run dev
```

**ブラウザで確認**:
- http://localhost:3002 にアクセス
- ログイン画面が表示されればOK ✅

### ステップ6-3: 管理者向けアプリを起動

**さらに別のターミナルウィンドウ**を開いて:

```bash
cd /Users/mocky700/Desktop/デミセル/admin
npm run dev
```

**ブラウザで確認**:
- http://localhost:3003 にアクセス
- 管理者ログイン画面が表示されればOK ✅

### ステップ6-4: 管理者ログインテスト

1. http://localhost:3003 にアクセス
2. 先ほど作成した管理者アカウントでログイン:
   - Email: `admin@example.com`
   - Password: `Admin123!@#`
3. 「ログイン」をクリック
4. ダッシュボードが表示されればOK ✅

### ステップ6-5: 出店者登録テスト

1. http://localhost:3001 にアクセス
2. 「新規登録」をクリック
3. 「メールアドレスで登録」を選択
4. メールアドレスとパスワードを入力
5. 登録フォームが表示されればOK ✅

---

## 🎉 完全セットアップ完了！

おめでとうございます！すべての設定が完了しました。

### ✅ 設定完了チェックリスト

- [x] Supabaseプロジェクト作成
- [x] Supabase APIキー取得
- [x] データベーステーブル作成（5つ）
- [x] Storageバケット作成（2つ）
- [x] Google認証設定
- [x] LINE Loginチャネル作成（2つ）
- [x] OpenAI API Key取得
- [x] 環境変数ファイル作成（3つ）
- [x] 管理者ユーザー作成
- [x] アプリ起動確認（3つ）

### 📱 アプリのURL

- **出店者向けアプリ**: http://localhost:3001
- **主催者向けアプリ**: http://localhost:3002
- **管理者向けアプリ**: http://localhost:3003

### 🔐 ログイン方法

**出店者・主催者**:
- LINE Login
- Google認証
- メールアドレス認証

**管理者**:
- メールアドレス認証のみ

### 💡 次のステップ

1. **テストユーザーを作成**
   - 出店者として登録
   - 主催者として登録

2. **機能をテスト**
   - イベント作成
   - イベント申し込み
   - 画像アップロード
   - 画像認識機能

3. **管理者機能をテスト**
   - 主催者の承認
   - イベントの承認
   - 統計情報の確認

### 🆘 トラブルシューティング

#### エラー: "Missing Supabase environment variables"
→ `.env.local`ファイルが正しい場所にあるか確認
→ サーバーを再起動（`Ctrl + C`で停止して、`npm run dev`で再起動）

#### データベース接続エラー
→ Supabase URLとAnon Keyが正しいか確認
→ ブラウザのコンソールでエラー内容を確認

#### LINE Loginが動作しない
→ Channel IDが正しいか確認
→ Callback URLが正しく設定されているか確認

#### OpenAI APIエラー
→ API Keyが正しいか確認
→ 支払い方法が登録されているか確認
→ 使用上限に達していないか確認

---

## 📞 サポート

問題が発生した場合は、以下の情報を含めて質問してください：

1. どのアプリで問題が発生したか
2. エラーメッセージ（あれば）
3. ブラウザのコンソールログ
4. どのステップで問題が発生したか

すべての機能が正常に動作することを確認してください！

